(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["05ab4153"],{"3e59":function(e,t,i){},"444c":function(e,t,i){"use strict";var s=function(){var e=this,t=e.$createElement,i=e._self._c||t;return e.shareDialogIsOpen||e.renameFolderPrompt||e.versionsDialogIsOpen?e.versionsDialogIsOpen?i("q-dialog",{ref:"versionsDialog",model:{value:e.versionsDialogIsOpen,callback:function(t){e.versionsDialogIsOpen=t},expression:"versionsDialogIsOpen"}},[i("versions-dialog",{attrs:{node:e.node}})],1):e.shareDialogIsOpen?i("q-dialog",{attrs:{persistent:""},model:{value:e.shareDialogIsOpen,callback:function(t){e.shareDialogIsOpen=t},expression:"shareDialogIsOpen"}},[i("q-card",{staticStyle:{"min-width":"400px"}},[i("q-card-section",{staticClass:"row"},[i("div",{staticClass:"text-h6 col"},[e._v("Share/Secure")]),i("div",[i("q-btn-toggle",{attrs:{value:e.security.public,size:"xs","toggle-color":"primary",options:[{label:"Private",value:!1},{label:"Center-wide",value:"center"},{label:"Public",value:!0}]},model:{value:e.security.public,callback:function(t){e.$set(e.security,"public",t)},expression:"security.public"}})],1)]),i("q-card-section",[i("q-select",{ref:"viewers",attrs:{options:e.searchedUsers,label:"View",multiple:"","use-chips":"","use-input":""},on:{input:function(t){return e.$refs.viewers.updateInputValue("")},filter:e.searchUsers},model:{value:e.security.viewers,callback:function(t){e.$set(e.security,"viewers",t)},expression:"security.viewers"}}),i("q-select",{ref:"uploaders",attrs:{options:e.searchedUsers,label:"Upload",multiple:"","use-chips":"","use-input":""},on:{input:function(t){return e.$refs.uploaders.updateInputValue("")},filter:e.searchUsers},model:{value:e.security.uploaders,callback:function(t){e.$set(e.security,"uploaders",t)},expression:"security.uploaders"}}),i("q-select",{ref:"modifiers",attrs:{options:e.searchedUsers,label:"Modify",multiple:"","use-chips":"","use-input":""},on:{input:function(t){return e.$refs.modifiers.updateInputValue("")},filter:e.searchUsers},model:{value:e.security.modifiers,callback:function(t){e.$set(e.security,"modifiers",t)},expression:"security.modifiers"}}),i("q-select",{ref:"removers",attrs:{options:e.searchedUsers,label:"Remove",multiple:"","use-chips":"","use-input":""},on:{input:function(t){return e.$refs.removers.updateInputValue("")},filter:e.searchUsers},model:{value:e.security.removers,callback:function(t){e.$set(e.security,"removers",t)},expression:"security.removers"}}),e.node.isFolder?i("q-select",{ref:"folderCreators",attrs:{options:e.searchedUsers,label:"Create Folder",multiple:"","use-chips":"","use-input":""},on:{input:function(t){return e.$refs.folderCreators.updateInputValue("")},filter:e.searchUsers},model:{value:e.security.folderCreators,callback:function(t){e.$set(e.security,"folderCreators",t)},expression:"security.folderCreators"}}):e._e(),e.node.isFolder?e._e():i("q-select",{ref:"approvers",attrs:{options:e.searchedUsers,label:"Approvers",multiple:"","use-chips":"","use-input":""},on:{input:function(t){return e.$refs.approvers.updateInputValue("")},filter:e.searchUsers},model:{value:e.security.approvers,callback:function(t){e.$set(e.security,"approvers",t)},expression:"security.approvers"}})],1),i("q-card-actions",{staticClass:"text-primary",attrs:{align:"right"}},[i("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:"Cancel"}}),i("q-btn",{attrs:{color:"primary",label:"Save"},on:{click:e.saveSecurity}})],1)],1)],1):i("q-dialog",{attrs:{persistent:""},model:{value:e.renameFolderPrompt,callback:function(t){e.renameFolderPrompt=t},expression:"renameFolderPrompt"}},[i("q-card",{staticStyle:{"min-width":"400px"}},[i("q-card-section",[i("div",{staticClass:"text-h6"},[e._v(" Rename "+e._s(e.node.isFolder?"folder":"file"))])]),i("q-card-section",[i("q-input",{attrs:{dense:"",autofocus:""},on:{keyup:function(t){if(!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter"))return null;e.newFolderPrompt=!1},focus:function(t){return e.$refs.target.select()}},model:{value:e.tempNode.label,callback:function(t){e.$set(e.tempNode,"label",t)},expression:"tempNode.label"}})],1),i("q-card-actions",{staticClass:"text-primary",attrs:{align:"right"}},[i("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:"Cancel"}}),i("q-btn",{attrs:{color:"primary",label:"Save"},on:{click:e.saveFolder}})],1)],1)],1):i("q-menu",{ref:"newMenu",attrs:{"touch-position":""}},[e.node.security?i("q-list",{staticClass:"q-pt-sm q-pb-sm",staticStyle:{"min-width":"200px"},attrs:{dense:""}},[i("q-item",{directives:[{name:"ripple",rawName:"v-ripple"}],attrs:{clickable:""},on:{click:function(t){return e.open(e.node)}}},[i("q-item-section",{attrs:{avatar:""}},[i("q-icon",{attrs:{color:"blue-grey",name:"open_with"}})],1),i("q-item-section",[e._v("Open")])],1),i("q-separator",{directives:[{name:"show",rawName:"v-show",value:e.$lodash.findIndex(e.node.security.approvers,function(t){return t.value._id===e.$root.user._id})>-1,expression:"$lodash.findIndex(node.security.approvers, user => user.value._id === $root.user._id) > -1"}],staticClass:"q-mt-sm q-mb-sm"}),e.node.security.approvers&&e.node.security.approvers.length?i("q-item",{directives:[{name:"ripple",rawName:"v-ripple"},{name:"show",rawName:"v-show",value:e.$lodash.findIndex(e.node.security.approvers,function(t){return t.value._id===e.$root.user._id})>-1,expression:"$lodash.findIndex(node.security.approvers, user => user.value._id === $root.user._id) > -1"}],attrs:{clickable:""}},[i("q-item-section",{attrs:{avatar:""}},[i("q-icon",{attrs:{color:"blue-grey",name:"thumb_up"}})],1),i("q-item-section",[e._v("Approved\n        ("+e._s(e.node.security.approvers.filter(function(e){return e.approved}).length)+"/"+e._s(e.node.security.approvers.length)+")\n      ")]),e.node.security.approvers.filter(function(e){return!e.approved}).length?i("approve-dialog",{attrs:{node:e.node}}):e._e()],1):e._e(),i("q-separator",{directives:[{name:"show",rawName:"v-show",value:e.$lodash.findIndex(e.node.security.modifiers,function(t){return t.value._id===e.$root.user._id})>-1||e.node.owner===e.$root.user._id,expression:"$lodash.findIndex(node.security.modifiers, user => user.value._id === $root.user._id) > -1 || node.owner === $root.user._id"}],staticClass:"q-mt-sm q-mb-sm"}),i("q-item",{directives:[{name:"show",rawName:"v-show",value:e.$lodash.findIndex(e.node.security.modifiers,function(t){return t.value._id===e.$root.user._id})>-1||e.node.owner===e.$root.user._id,expression:"$lodash.findIndex(node.security.modifiers, user => user.value._id === $root.user._id) > -1 || node.owner === $root.user._id"},{name:"ripple",rawName:"v-ripple"}],attrs:{clickable:""},on:{click:function(t){e.shareDialogIsOpen=!0}}},[i("q-item-section",{attrs:{avatar:""}},[i("q-icon",{attrs:{color:"blue-grey",name:"share"}})],1),i("q-item-section",[e._v("Share/Secure")])],1),i("q-item",{directives:[{name:"show",rawName:"v-show",value:e.$lodash.findIndex(e.node.security.modifiers,function(t){return t.value._id===e.$root.user._id})>-1||e.node.owner===e.$root.user._id,expression:"$lodash.findIndex(node.security.modifiers, user => user.value._id === $root.user._id) > -1 || node.owner === $root.user._id"},{name:"ripple",rawName:"v-ripple"}],attrs:{clickable:""}},[i("q-item-section",{attrs:{avatar:""}},[i("q-icon",{attrs:{color:"blue-grey",name:"subdirectory_arrow_right"}})],1),i("q-item-section",[e._v("Move to")]),i("move-to",{attrs:{node:e.node}})],1),i("q-item",{directives:[{name:"show",rawName:"v-show",value:e.$lodash.findIndex(e.node.security.modifiers,function(t){return t.value._id===e.$root.user._id})>-1||e.node.owner===e.$root.user._id,expression:"$lodash.findIndex(node.security.modifiers, user => user.value._id === $root.user._id) > -1 || node.owner === $root.user._id"},{name:"ripple",rawName:"v-ripple"}],attrs:{clickable:""},on:{click:e.showRenameModal}},[i("q-item-section",{attrs:{avatar:""}},[i("q-icon",{attrs:{color:"blue-grey",name:"edit"}})],1),i("q-item-section",[e._v("Rename")])],1),e.node.isFolder?e._e():i("q-item",{directives:[{name:"ripple",rawName:"v-ripple"}],attrs:{clickable:""},on:{click:function(t){e.versionsDialogIsOpen=!0}}},[i("q-item-section",{attrs:{avatar:""}},[i("q-icon",{attrs:{color:"blue-grey",name:"color_lens"}})],1),i("q-item-section",[e._v("Versions")])],1),i("q-separator",{staticClass:"q-mt-sm q-mb-sm"}),i("q-item",{directives:[{name:"close-popup",rawName:"v-close-popup"},{name:"show",rawName:"v-show",value:e.$lodash.findIndex(e.node.security.removers,function(t){return t.value._id===e.$root.user._id})>-1||e.node.owner===e.$root.user._id,expression:"$lodash.findIndex(node.security.removers, user => user.value._id === $root.user._id) > -1 || node.owner === $root.user._id"},{name:"ripple",rawName:"v-ripple"}],attrs:{clickable:""},on:{click:e.remove}},[i("q-item-section",{attrs:{avatar:""}},[i("q-icon",{attrs:{color:"blue-grey",name:"delete_outline"}})],1),i("q-item-section",[e._v("Remove")])],1)],1):e._e()],1)},o=[],r=(i("ac6a"),i("cadf"),i("06db"),i("456d"),i("7514"),i("967e")),n=i.n(r),a=(i("96cf"),i("fa84")),l=i.n(a),c=i("02fa"),d=i.n(c),u=i("2ef0"),p=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("q-menu",{attrs:{anchor:"top right",self:"top left"}},[i("q-toolbar",{staticClass:"bg-grey-3 text-grey-14",staticStyle:{"min-height":"32px !important"}},["My Drive"!==e.parentNode.label?i("q-btn",{attrs:{flat:"",round:"",dense:"",size:"sm",icon:"arrow_back"},on:{click:e.previousFolder}}):e._e(),i("div",{staticClass:"col text-center"},[e._v("\n      "+e._s(e.parentNode.label)+"\n    ")])],1),i("q-separator"),i("div",{staticStyle:{height:"120px","overflow-y":"scroll"}},[i("q-list",{staticStyle:{width:"250px"},attrs:{dense:""}},e._l(e.folders.filter(function(t){return t._id!==e.node._id}),function(t){return i("q-item",{directives:[{name:"ripple",rawName:"v-ripple"}],key:t._id,attrs:{clickable:"",active:t._id===e.activeNode._id,"active-class":"bg-light-blue text-white"},on:{click:function(i){e.activeNode=Object.assign({},t)},dblclick:function(i){return e.dblClickFolder(t)}}},[i("q-item-section",{attrs:{avatar:""}},[i("q-btn",{attrs:{round:"",size:"sm",flat:""}},[i("q-icon",{attrs:{color:t._id===e.activeNode._id?"white":"blue-grey",name:"folder_open",size:"sm"}})],1)],1),i("q-item-section",[i("span",{staticClass:"limited-text"},[e._v("\n            "+e._s(t.label)+"\n          ")])])],1)}),1)],1),i("q-separator"),i("div",{staticClass:"row q-pa-sm"},[i("div",{staticClass:"col"},[e.$lodash.isEmpty(e.activeNode)?i("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{color:"primary",disabled:e.node.parentFolder===e.parentNode._id},on:{click:e.move}},[e._v("Move here")]):i("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{color:"primary"},on:{click:e.move}},[e._v("Move")])],1),i("q-btn",{attrs:{flat:"",round:"","text-color":"grey-14",icon:"create_new_folder"}})],1)],1)},v=[],h={data:function(){return{parentNode:{label:"...",parentFolder:"My Drive",_id:"My Drive"},folders:[],activeNode:{},tempNode:{}}},props:["node"],mounted:function(){this.getParentFolders(this.node),this.tempNode=this.$lodash.cloneDeep(this.node)},methods:{move:function(){var e=l()(n.a.mark(function e(){var t,i,s,o,r=this;return n.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(t=this.node.parentFolder,i=null,!this.$lodash.isEmpty(this.activeNode)){e.next=11;break}return this.tempNode.parentFolder=this.parentNode._id,s={action:"Moved",timestamp:Date.now(),data:{new:this.$deepDiff(this.tempNode,this.node),old:this.$deepDiff(this.node,this.tempNode)},user:this.$root.user},console.log("LOG",s),e.next=8,this.$dbCon.services[this.node.isFolder?"juan-folders":"juan-files"].patch(this.node._id,{parentFolder:this.parentNode._id,logs:this.node.logs.concat([s])});case 8:i=this.parentNode,e.next=17;break;case 11:return this.tempNode.parentFolder=this.activeNode._id,o={action:"Moved",timestamp:Date.now(),data:{new:this.$deepDiff(this.tempNode,this.node),old:this.$deepDiff(this.node,this.tempNode)},user:this.$root.user},console.log("LOG",o),e.next=16,this.$dbCon.services[this.node.isFolder?"juan-folders":"juan-files"].patch(this.node._id,{parentFolder:this.activeNode._id,logs:this.node.logs.concat([o])});case 16:i=this.activeNode;case 17:this.$q.notify({message:this.node.label+"was moved to "+i.label,position:"bottom-left",actions:[{label:"Undo",handler:function(){var e=l()(n.a.mark(function e(){return n.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,r.$dbCon.services[r.node.isFolder?"juan-folders":"juan-files"].patch(r.node._id,{parentFolder:t});case 2:case"end":return e.stop()}},e)}));function i(){return e.apply(this,arguments)}return i}()}]});case 18:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}(),previousFolder:function(){var e=l()(n.a.mark(function e(t){return n.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.getParentFolders(this.parentNode);case 2:this.activeNode={},console.log("April 30",this.activeNode._id===this.parentNode._id,this.node.parentFolder===this.parentNode._id);case 4:case"end":return e.stop()}},e,this)}));function t(t){return e.apply(this,arguments)}return t}(),dblClickFolder:function(){var e=l()(n.a.mark(function e(t){var i,s,o,r;return n.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return this.parentNode=d()({},t),console.log(t),i=this.$root.global,s=i.condition,o=i.$or,e.next=5,this.$dbCon.services["juan-folders"].find({query:d()({$limit:500,parentFolder:t._id},s,{$or:o})});case 5:r=e.sent,this.folders=r.data,this.activeNode={};case 8:case"end":return e.stop()}},e,this)}));function t(t){return e.apply(this,arguments)}return t}(),getParentFolders:function(){var e=l()(n.a.mark(function e(t){var i,s,o;return n.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(console.log(t),"My Drive"!==t.parentFolder){e.next=5;break}this.parentNode={label:"My Drive",parentFolder:"My Drive",_id:"My Drive"},e.next=8;break;case 5:return e.next=7,this.$dbCon.services["juan-folders"].get(t.parentFolder);case 7:this.parentNode=e.sent;case 8:return i={$sort:{"logs.0.timestamp":-1},trash:{$ne:!0}},s=[{"security.public":!0},{"security.public":{$ne:!1}},{owner:this.$root.user._id},{"security.viewers":{$elemMatch:{"value._id":this.$root.user._id}}},{"security.uploaders":{$elemMatch:{"value._id":this.$root.user._id}}},{"security.modifiers":{$elemMatch:{"value._id":this.$root.user._id}}},{"security.removers":{$elemMatch:{"value._id":this.$root.user._id}}},{"security.folderCreators":{$elemMatch:{"value._id":this.$root.user._id}}},{"security.approvers":{$elemMatch:{"value._id":this.$root.user._id}}}],e.next=12,this.$dbCon.services["juan-folders"].find({query:d()({$limit:500,parentFolder:t.parentFolder},i,{$or:s})});case 12:o=e.sent,this.folders=o.data;case 14:case"end":return e.stop()}},e,this)}));function t(t){return e.apply(this,arguments)}return t}()}},f=h,m=(i("46d1"),i("2877")),b=Object(m["a"])(f,p,v,!1,null,null,null),g=b.exports,w=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("q-card",{staticStyle:{"min-width":"400px"}},[i("q-card-section",{staticClass:"row"},[i("div",{staticClass:"text-h6 col"},[e._v("Manage Version")]),i("div",[e.node.security.approvers&&(1===e.node.versions.length||e.node.versions[0].approved)&&e.node.owner===e.$root.user._id||e.$lodash.findIndex(e.node.security.modifiers,function(t){return t.value._id===e.$root.user._id})>-1?i("q-btn",{attrs:{label:"Draft a Revision"},on:{click:e.openDraftDialog}}):e._e(),i("q-dialog",{ref:"draftDialog",attrs:{persistent:""},model:{value:e.draftDialogIsOpen,callback:function(t){e.draftDialogIsOpen=t},expression:"draftDialogIsOpen"}},[i("upload-draft",{attrs:{draftDialog:e.draftDialog,node:e.node}})],1)],1)]),i("q-card-section",{staticClass:"col"},[i("q-list",{staticClass:"q-pt-sm q-pb-sm",staticStyle:{"min-width":"200px"},attrs:{dense:""}},[1===e.node.versions.length?i("q-item",{directives:[{name:"ripple",rawName:"v-ripple"}],attrs:{clickable:""}},[i("q-item-section",{attrs:{avatar:""}},[i("q-icon",{attrs:{color:"blue-grey",name:"history"}})],1),i("q-item-section",[i("q-item-label",{attrs:{lines:"1"}},[e._v(e._s(e.node.versions[0].version))]),i("q-item-label",{attrs:{caption:""}},[e._v(e._s(e.node.versions[0].dateUploaded))])],1)],1):i("span",e._l(e.node.versions,function(t,s){return i("q-item",{directives:[{name:"ripple",rawName:"v-ripple"}],key:"ver"+s,attrs:{clickable:""}},[i("q-item-section",{attrs:{avatar:""}},[i("q-icon",{attrs:{color:"blue-grey",name:"history"}})],1),i("q-item-section",[i("q-item-label",{attrs:{lines:"1"}},[e._v(e._s(t.version))]),i("q-item-label",{attrs:{caption:""}},[e._v(e._s(t.dateUploaded))])],1),t.approved||0!==s?e._e():i("q-item-section",{attrs:{side:""}},[i("q-chip",{attrs:{color:"deep-orange","text-color":"white",icon:"thumbs_up_down"}},[e._v("\n              Draft\n            ")])],1),t.approved||0!==s||t.initiator!==e.$root.user._id?e._e():i("q-item-section",{attrs:{side:""}},[i("q-btn",{attrs:{icon:"edit",round:"",size:"sm"},on:{click:e.openEditDraftDialog}}),i("q-dialog",{ref:"editDraftDialog",refInFor:!0,attrs:{persistent:""},model:{value:e.editDraftDialogIsOpen,callback:function(t){e.editDraftDialogIsOpen=t},expression:"editDraftDialogIsOpen"}},[i("edit-draft",{attrs:{draftDialog:e.editDraftDialog,node:e.node,vi:s}})],1)],1),!t.approved&&0===s&&(e.$lodash.findIndex(e.node.security.approvers,function(t){return t.value._id===e.$root.user._id})>-1||e.node.logs[0].user._id===e.$root.user._id)?i("q-item-section",{attrs:{side:""}},[i("q-dialog",{ref:"viewDraftDialog",refInFor:!0,attrs:{persistent:""},model:{value:e.viewDraftDialogIsOpen,callback:function(t){e.viewDraftDialogIsOpen=t},expression:"viewDraftDialogIsOpen"}},[i("view-draft",{attrs:{draftDialog:e.viewDraftDialog,node:e.node,vi:s}})],1),i("q-btn",{attrs:{icon:"search",round:"",size:"sm"},on:{click:e.openViewDraftDialog}})],1):e._e(),t.approved||0!==s?i("q-item-section",{attrs:{side:""}},[i("q-btn",{attrs:{icon:"cloud_download",round:"",size:"sm"},on:{click:function(i){return e.open(t._id)}}})],1):e._e()],1)}),1)],1)],1)],1)},_=[],y=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("q-card",{staticStyle:{"min-width":"80vw"}},[i("q-card-section",{staticClass:"row"},[i("div",{staticClass:"text-h6 col"},[e._v("Revision Request")]),i("div",[i("q-btn",{attrs:{dense:"",round:"",icon:"close"},on:{click:e.close}})],1)]),i("q-card-section",{staticClass:"col"},[i("div",{staticClass:"row"},[i("div",{staticClass:"col"},[i("div",{staticClass:"row q-gutter-md"},[i("q-input",{staticClass:"col-xs-11 col-sm-11 col-md col-lg col-xl-4",attrs:{label:"Code",autofocus:""},model:{value:e.revision.code,callback:function(t){e.$set(e.revision,"code",t)},expression:"revision.code"}}),i("q-input",{attrs:{label:"Previous version"},model:{value:e.revision.previousVersion,callback:function(t){e.$set(e.revision,"previousVersion",t)},expression:"revision.previousVersion"}}),i("q-input",{attrs:{label:"New version"},model:{value:e.revision.version,callback:function(t){e.$set(e.revision,"version",t)},expression:"revision.version"}})],1),i("div",{staticClass:"row q-gutter-md"},[i("q-input",{staticClass:"col-xs-11 col-sm-11 col-md col-lg col-xl-4",attrs:{label:"Title"},model:{value:e.revision.title,callback:function(t){e.$set(e.revision,"title",t)},expression:"revision.title"}}),i("q-input",{staticStyle:{position:"relative",top:"10px"},attrs:{label:"Effectivity Date",mask:"date",rules:["date"]},scopedSlots:e._u([{key:"append",fn:function(){return[i("q-icon",{staticClass:"cursor-pointer",attrs:{name:"event"}},[i("q-popup-proxy",{ref:"qDateProxy",attrs:{"transition-show":"scale","transition-hide":"scale"}},[i("q-date",{on:{input:function(){return e.$refs.qDateProxy.hide()}},model:{value:e.revision.effectivityDate,callback:function(t){e.$set(e.revision,"effectivityDate",t)},expression:"revision.effectivityDate"}})],1)],1)]},proxy:!0}]),model:{value:e.revision.effectivityDate,callback:function(t){e.$set(e.revision,"effectivityDate",t)},expression:"revision.effectivityDate"}})],1)])]),i("div",{staticClass:"col q-pt-md q-gutter-md"},[i("div",[e._v("Reason")]),i("q-editor",{attrs:{"min-height":"5rem",toolbar:e.toolbar,fonts:e.fonts},model:{value:e.revision.reason,callback:function(t){e.$set(e.revision,"reason",t)},expression:"revision.reason"}}),i("div",[e._v("Details")]),i("q-editor",{attrs:{"min-height":"5rem",toolbar:e.toolbar,fonts:e.fonts},model:{value:e.revision.details,callback:function(t){e.$set(e.revision,"details",t)},expression:"revision.details"}})],1),i("q-card-actions",{staticClass:"text-primary",attrs:{align:"right"}},[i("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:"Cancel"}}),i("q-btn",{attrs:{disabled:!e.revision.reason||!e.revision.details||!e.revision.version,color:"primary",label:"Submit"},on:{click:e.submit}})],1)],1)],1)},$=[],q=(i("6b54"),i("f751"),i("28a5"),{props:["draftDialog","node"],mounted:function(){var e=this;this.$nextTick(function(){e.draftUploader=e.$refs.draftUploader})},data:function(){var e=this.currentVersion(this.node);console.log("currentVersion",e);var t="",i="";if("undefined"!==typeof e.previousVersion){t=e.version;var s=e.version.split(".");++s[s.length-1],i=s.join(".")}else"undefined"===typeof e.previousVersion&&(t=e.version,i="0.0.0");return{draftUploader:{files:[]},jwt:window.localStorage.getItem("".concat(this.$dbCon.io.io.uri,"-jwt")),revision:{effectivityDate:null,code:"",title:this.node.label,previousVersion:t,version:i,reason:"",details:"",initiator:this.$root.user._id,approved:!1},toolbar:[["left","center","right","justify"],["bold","italic","strike","underline","subscript","superscript"],["token","hr","link","custom_btn"],[{label:this.$q.lang.editor.formatting,icon:this.$q.iconSet.editor.formatting,list:"no-icons",options:["p","h1","h2","h3","h4","h5","h6","code"]},{label:this.$q.lang.editor.fontSize,icon:this.$q.iconSet.editor.fontSize,fixedLabel:!0,fixedIcon:!0,list:"no-icons",options:["size-1","size-2","size-3","size-4","size-5","size-6","size-7"]},{label:this.$q.lang.editor.defaultFont,icon:this.$q.iconSet.editor.font,fixedIcon:!0,list:"no-icons",options:["default_font","arial","arial_black","comic_sans","courier_new","impact","lucida_grande","times_new_roman","verdana"]},"removeFormat"],["quote","unordered","ordered","outdent","indent"],["undo","redo"],["print","fullscreen"]],fonts:{arial:"Arial",arial_black:"Arial Black",comic_sans:"Comic Sans MS",courier_new:"Courier New",impact:"Impact",lucida_grande:"Lucida Grande",times_new_roman:"Times New Roman",verdana:"Verdana"}}},methods:{close:function(){this.draftDialog.hide()},submit:function(){var e=l()(n.a.mark(function e(){var t,i,s,o,r=this;return n.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return this.$q.loading.show({message:"Submitting Draft ".concat(this.revision.version)}),e.prev=1,t=this.$lodash.cloneDeep(this.node.versions),i=Object.assign({},this.revision),i.effectivityDate=new Date(this.revision.effectivityDate).getTime(),i.approvers=this.$lodash.cloneDeep(this.node.security.approvers).map(function(e){return e.approved=!1,e}),t.unshift(i),s=this.$lodash.cloneDeep(this.node.logs),o={action:"Revision Requested",timestamp:Date.now(),data:i,user:this.$root.user},s.push(o),e.next=12,this.$dbCon.services["juan-files"].patch(this.node._id,{versions:t,logs:s});case 12:i.approvers.map(function(){var e=l()(n.a.mark(function e(t){return n.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,r.$dbCon.services["juan-notifs"].create({from:r.$root.user,to:t.value,action:"Revision requested",access:"revision",data:r.node,timestamp:Date.now(),seen:!1});case 2:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),this.draftDialog.hide(),this.$q.notify({message:"Revision requested",position:"bottom-right",color:"positive"}),e.next=20;break;case 17:e.prev=17,e.t0=e["catch"](1),this.$q.notify({message:e.t0.toString(),position:"bottom-right",color:"negative"});case 20:this.$q.loading.hide();case 21:case"end":return e.stop()}},e,this,[[1,17]])}));function t(){return e.apply(this,arguments)}return t}(),currentVersion:function(e){var t=null;return t="undefined"===typeof e.versions[0].approved?0:e.versions[0].approved?0:1,e.versions[t]}}}),x=q,D=Object(m["a"])(x,y,$,!1,null,null,null),k=D.exports,C=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("q-card",{staticStyle:{"min-width":"80vw"}},[i("q-card-section",{staticClass:"row"},[i("div",{staticClass:"text-h6 col"},[e._v("Edit Draft")]),i("div",[i("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{dense:"",round:"",icon:"close"}})],1)]),i("q-card-section",{staticClass:"col"},[i("div",{staticClass:"row"},[i("div",{staticClass:"col"},[i("div",{staticClass:"row q-gutter-md"},[i("q-input",{staticClass:"col-xs-11 col-sm-11 col-md col-lg col-xl-4",attrs:{label:"Code",autofocus:""},model:{value:e.revision.code,callback:function(t){e.$set(e.revision,"code",t)},expression:"revision.code"}}),i("q-input",{attrs:{label:"Previous version"},model:{value:e.revision.previousVersion,callback:function(t){e.$set(e.revision,"previousVersion",t)},expression:"revision.previousVersion"}}),i("q-input",{attrs:{label:"New version"},model:{value:e.revision.version,callback:function(t){e.$set(e.revision,"version",t)},expression:"revision.version"}})],1),i("div",{staticClass:"row q-gutter-md"},[i("q-input",{staticClass:"col-xs-11 col-sm-11 col-md col-lg col-xl-4",attrs:{label:"Title"},model:{value:e.revision.title,callback:function(t){e.$set(e.revision,"title",t)},expression:"revision.title"}}),i("q-input",{staticStyle:{position:"relative",top:"10px"},attrs:{label:"Effectivity Date",mask:"date",rules:["date"]},scopedSlots:e._u([{key:"append",fn:function(){return[i("q-icon",{staticClass:"cursor-pointer",attrs:{name:"event"}},[i("q-popup-proxy",{ref:"qDateProxy",attrs:{"transition-show":"scale","transition-hide":"scale"}},[i("q-date",{on:{input:function(){return e.$refs.qDateProxy.hide()}},model:{value:e.revision.effectivityDate,callback:function(t){e.$set(e.revision,"effectivityDate",t)},expression:"revision.effectivityDate"}})],1)],1)]},proxy:!0}]),model:{value:e.revision.effectivityDate,callback:function(t){e.$set(e.revision,"effectivityDate",t)},expression:"revision.effectivityDate"}})],1)])]),i("div",{staticClass:"col q-pt-md q-gutter-md"},[i("div",[e._v("Reason")]),i("q-editor",{attrs:{"min-height":"5rem",toolbar:e.toolbar,fonts:e.fonts},model:{value:e.revision.reason,callback:function(t){e.$set(e.revision,"reason",t)},expression:"revision.reason"}}),i("div",[e._v("Details")]),i("q-editor",{attrs:{"min-height":"5rem",toolbar:e.toolbar,fonts:e.fonts},model:{value:e.revision.details,callback:function(t){e.$set(e.revision,"details",t)},expression:"revision.details"}})],1),i("q-card-actions",{staticClass:"text-primary",attrs:{align:"right"}},[i("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:"Cancel"}}),i("q-btn",{attrs:{disabled:!e.revision.reason||!e.revision.details||!e.revision.version,color:"primary",label:"Submit"},on:{click:e.submit}})],1)],1)],1)},N=[],I={props:["draftDialog","node","vi"],mounted:function(){var e=this;this.$nextTick(function(){e.draftUploader=e.$refs.draftUploader,console.log("mounted this.draftUploader",e.draftUploader)})},data:function(){return{file:this.node,draftUploader:{files:[]},jwt:window.localStorage.getItem("".concat(this.$dbCon.io.io.uri,"-jwt")),revision:{effectivityDate:this.node.versions[this.vi].effectivityDate,code:this.node.versions[this.vi].code,title:this.node.versions[this.vi].title,previousVersion:this.node.versions[this.vi].previousVersion,version:this.node.versions[this.vi].version,reason:this.node.versions[this.vi].reason,details:this.node.versions[this.vi].details,initiator:this.node.versions[this.vi].initiator,approved:this.node.versions[this.vi].approved},toolbar:[["left","center","right","justify"],["bold","italic","strike","underline","subscript","superscript"],["token","hr","link","custom_btn"],[{label:this.$q.lang.editor.formatting,icon:this.$q.iconSet.editor.formatting,list:"no-icons",options:["p","h1","h2","h3","h4","h5","h6","code"]},{label:this.$q.lang.editor.fontSize,icon:this.$q.iconSet.editor.fontSize,fixedLabel:!0,fixedIcon:!0,list:"no-icons",options:["size-1","size-2","size-3","size-4","size-5","size-6","size-7"]},{label:this.$q.lang.editor.defaultFont,icon:this.$q.iconSet.editor.font,fixedIcon:!0,list:"no-icons",options:["default_font","arial","arial_black","comic_sans","courier_new","impact","lucida_grande","times_new_roman","verdana"]},"removeFormat"],["quote","unordered","ordered","outdent","indent"],["undo","redo"],["print","fullscreen"]],fonts:{arial:"Arial",arial_black:"Arial Black",comic_sans:"Comic Sans MS",courier_new:"Courier New",impact:"Impact",lucida_grande:"Lucida Grande",times_new_roman:"Times New Roman",verdana:"Verdana"}}},methods:{close:function(){console.log("this.draftDialog",this.draftDialog),this.draftDialog[0].hide()},submit:function(){this.$q.loading.show({message:"Submitting Draft ".concat(this.revision.version)}),this.patch()},uploaded:function(){var e=l()(n.a.mark(function e(t){var i;return n.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:console.log("UPLOADED");try{i=JSON.parse(t.xhr.response),i=Object.assign(i,this.revision),i.effectivityDate=new Date(this.revision.effectivityDate).getTime(),i.dateUploaded=(new Date).getTime(),i.approvers=this.$lodash.cloneDeep(this.node.security.approvers),this.$dbCon.service("uploads").patch(i._id,{parentNode:this.node._id}),console.log("file",i),this.patch(i)}catch(s){this.$q.notify({message:s.toString(),position:"bottom-right",color:"negative"})}this.$q.loading.hide();case 3:case"end":return e.stop()}},e,this)}));function t(t){return e.apply(this,arguments)}return t}(),patch:function(){var e=l()(n.a.mark(function e(){var t,i,s,o=this,r=arguments;return n.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return t=r.length>0&&void 0!==r[0]?r[0]:{},i={},s={},Object.assign(s,t),Object.assign(s,this.revision),s.approvers=this.$lodash.cloneDeep(this.node.security.approvers),i["versions.".concat(this.vi)]=s,e.next=9,this.$dbCon.services["juan-files"].patch(this.node._id,i);case 9:this.node.security.approvers.map(function(){var e=l()(n.a.mark(function e(t){return n.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,o.$dbCon.services["juan-notifs"].create({from:o.$root.user,to:t.value,action:"edited a draft",access:"revision",data:o.node,timestamp:Date.now(),seen:!1});case 2:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),this.draftDialog[0].hide(),this.$q.notify({message:"Draft was edited",position:"bottom-right",color:"positive"}),this.$q.loading.hide();case 13:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}(),currentVersion:function(e){var t=null;return t="undefined"===typeof e.versions[0].approved?0:e.versions[0].approved?0:1,e.versions[t]},open:function(e){window.open("".concat(this.$dbCon.io.io.uri,"/uploads?_id=").concat(e),"_blank")}}},S=I,j=Object(m["a"])(S,C,N,!1,null,null,null),O=j.exports,F=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("q-card",{staticStyle:{"min-width":"80vw"}},[i("q-card-section",{staticClass:"row"},[i("div",{staticClass:"text-h6 col"},[e._v("Draft")]),i("div",[i("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{dense:"",round:"",icon:"close"}})],1)]),i("q-card-section",{staticClass:"col"},[i("div",{staticClass:"row"},[e.file.versions[e.vi].initiator===e.$root.user._id?i("div",{staticClass:"col-xs-12 col-sm col-md-4 col-lg-4 col-xl-4 q-mr-md"},[e.file.versions[e.vi]._id?i("q-card",{key:e.file.versions[e.vi]._id,staticClass:"no-shadow",attrs:{bordered:""}},[e.file.versions&&e.$lodash.isImage(e.file.versions[e.vi].fileName)?i("div",{staticClass:"thumbnail"},[i("img",{staticClass:"portrait",attrs:{src:e.$dbCon.io.io.uri+"/uploads?_id="+e.file.versions[e.vi]._id,alt:"Image"}})]):e.$lodash.isVideo(e.file.versions[e.vi].fileName)?i("div",{staticClass:"thumbnail"},[i("video",{staticClass:"thumbnail",attrs:{controls:"",preload:"none"}},[i("source",{attrs:{src:e.$dbCon.io.io.uri+"/uploads?_id="+e.file.versions[e.vi]._id}}),e._v("\n              Your browser does not support the video tag.\n            ")])]):i("div",{staticClass:"row justify-center bg-blue-grey-1"},[i("q-icon",{staticClass:"q-pt-md q-pb-md",attrs:{name:"insert_drive_file",size:"72px",color:"blue-grey-14 thumbnail"}})],1),i("q-card-section",{staticClass:"row items-center no-wrap",staticStyle:{"max-height":"56px"}},[i("div",{staticClass:"col text-weight-regular limited-text",class:{"text-primary":e.$root.clickedItem._id===e.file._id,"text-blue-grey-14":e.$root.clickedItem._id!==e.file._id}},[i("q-btn",{staticClass:"bg-white q-mr-sm",attrs:{round:"",flat:"",color:"blue-grey-14",size:"sm",icon:"insert_drive_file"}}),i("span",[e._v("\n                "+e._s(e.file.label)+"\n                "),e.file.label.length>25?i("q-tooltip",[e._v("\n                  "+e._s(e.file.label)+"\n                ")]):e._e()],1)],1),i("div",{staticClass:"col-auto"},[i("q-btn",{staticClass:"no-shadow text-grey-7",attrs:{round:"",icon:"cloud_download",color:"grey-11",size:"sm"},on:{click:function(t){return e.open(e.file.versions[e.vi]._id)}}})],1)])],1):e._e(),i("div",{staticClass:"row"},[i("q-uploader",{ref:"draftUploader",staticClass:"col",attrs:{headers:[{name:"Authorization",value:e.jwt}],url:e.$dbCon.io.io.uri+"/uploads","field-name":"file"},on:{uploaded:e.uploaded}})],1)],1):e._e(),i("div",{staticClass:"col"},[i("div",{staticClass:"row q-gutter-md"},[i("q-input",{staticClass:"col-xs-11 col-sm-11 col-md col-lg col-xl-4",attrs:{label:"Code",autofocus:"",readonly:""},model:{value:e.revision.code,callback:function(t){e.$set(e.revision,"code",t)},expression:"revision.code"}}),i("q-input",{attrs:{label:"Previous version",readonly:""},model:{value:e.revision.previousVersion,callback:function(t){e.$set(e.revision,"previousVersion",t)},expression:"revision.previousVersion"}}),i("q-input",{attrs:{label:"New version",readonly:""},model:{value:e.revision.version,callback:function(t){e.$set(e.revision,"version",t)},expression:"revision.version"}})],1),i("div",{staticClass:"row q-gutter-md"},[i("q-input",{staticClass:"col-xs-11 col-sm-11 col-md col-lg col-xl-4",attrs:{readonly:"",label:"Title"},model:{value:e.revision.title,callback:function(t){e.$set(e.revision,"title",t)},expression:"revision.title"}}),i("q-input",{staticStyle:{position:"relative",top:"10px"},attrs:{readonly:"",label:"Effectivity Date",mask:"date",rules:["date"]},scopedSlots:e._u([{key:"append",fn:function(){return[i("q-icon",{staticClass:"cursor-pointer",attrs:{name:"event"}},[i("q-popup-proxy",{ref:"qDateProxy",attrs:{"transition-show":"scale","transition-hide":"scale"}},[i("q-date",{on:{input:function(){return e.$refs.qDateProxy.hide()}},model:{value:e.revision.effectivityDate,callback:function(t){e.$set(e.revision,"effectivityDate",t)},expression:"revision.effectivityDate"}})],1)],1)]},proxy:!0}]),model:{value:e.revision.effectivityDate,callback:function(t){e.$set(e.revision,"effectivityDate",t)},expression:"revision.effectivityDate"}})],1)])]),i("div",{staticClass:"col q-pt-md q-pb-md q-gutter-md"},[i("div",[e._v("Reason")]),i("q-editor",{attrs:{"min-height":"5rem",toolbar:[],fonts:e.fonts,readonly:""},model:{value:e.revision.reason,callback:function(t){e.$set(e.revision,"reason",t)},expression:"revision.reason"}}),i("div",[e._v("Details")]),i("q-editor",{attrs:{"min-height":"5rem",toolbar:[],fonts:e.fonts,readonly:""},model:{value:e.revision.details,callback:function(t){e.$set(e.revision,"details",t)},expression:"revision.details"}}),i("div",[e._v("Approvers")])],1),i("div",{staticClass:"row q-gutter-md"},e._l(e.node.versions[e.vi].approvers,function(t,s){return i("div",{key:"approvers"+s,staticStyle:{width:"320px"}},[i("div",{staticClass:"row q-pt-md"},[i("div",{staticClass:"col"},[i("div",[e._v(e._s(t.label))]),t.approved?i("q-chip",{attrs:{dense:""}},[i("q-avatar",{attrs:{icon:"thumb_up",color:"green","text-color":"white"}}),e._v("\n                "+e._s(t.timestamp)+"\n              ")],1):i("q-chip",{attrs:{dense:""}},[i("q-avatar",{attrs:{icon:"edit",color:"grey","text-color":"white"}}),e._v("\n                for signature\n              ")],1)],1),t.approved||t.value._id!==e.$root.user._id?e._e():i("q-btn",{staticClass:"item-end",attrs:{disabled:e.node.versions[e.vi].approvers[s-1]&&!e.node.versions[e.vi].approvers[s-1].approved},on:{click:function(){e.$log(e.refs),e.approve(s)}}},[e._v("\n              Approve\n            ")])],1)])}),0),i("q-card-actions",{staticClass:"text-primary",attrs:{align:"right"}},[i("q-btn",{attrs:{disabled:e.file.versions[e.vi].initiator!==e.$root.user._id||!e.file.versions[e.vi]._id||e.node.versions[e.vi].initiator!==e.$root.user._id||e.node.versions[e.vi].approvers.filter(function(e){return e.approved}).length!==e.node.versions[e.vi].approvers.length,color:"primary",label:"Publish"},on:{click:e.publish}})],1)],1)],1)},P=[],z={props:["draftDialog","node","vi"],mounted:function(){this.refs=this.$refs,this.$nextTick(function(){})},data:function(){return{refs:{},file:this.node,draftUploader:{files:[]},jwt:window.localStorage.getItem("".concat(this.$dbCon.io.io.uri,"-jwt")),revision:{effectivityDate:this.node.versions[this.vi].effectivityDate,code:this.node.versions[this.vi].code,title:this.node.versions[this.vi].title,previousVersion:this.node.versions[this.vi].previousVersion,version:this.node.versions[this.vi].version,reason:this.node.versions[this.vi].reason,details:this.node.versions[this.vi].details,initiator:this.node.versions[this.vi].initiator,approved:this.node.versions[this.vi].approved},toolbar:[["left","center","right","justify"],["bold","italic","strike","underline","subscript","superscript"],["token","hr","link","custom_btn"],[{label:this.$q.lang.editor.formatting,icon:this.$q.iconSet.editor.formatting,list:"no-icons",options:["p","h1","h2","h3","h4","h5","h6","code"]},{label:this.$q.lang.editor.fontSize,icon:this.$q.iconSet.editor.fontSize,fixedLabel:!0,fixedIcon:!0,list:"no-icons",options:["size-1","size-2","size-3","size-4","size-5","size-6","size-7"]},{label:this.$q.lang.editor.defaultFont,icon:this.$q.iconSet.editor.font,fixedIcon:!0,list:"no-icons",options:["default_font","arial","arial_black","comic_sans","courier_new","impact","lucida_grande","times_new_roman","verdana"]},"removeFormat"],["quote","unordered","ordered","outdent","indent"],["undo","redo"],["print","fullscreen"]],fonts:{arial:"Arial",arial_black:"Arial Black",comic_sans:"Comic Sans MS",courier_new:"Courier New",impact:"Impact",lucida_grande:"Lucida Grande",times_new_roman:"Times New Roman",verdana:"Verdana"}}},methods:{close:function(){console.log("this.draftDialog",this.draftDialog),this.draftDialog[0].hide()},approve:function(){var e=l()(n.a.mark(function e(t){var i=this;return n.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:this.$q.dialog({title:"Approval Authentication",message:"Enter Password",prompt:{model:"",type:"password"},cancel:!0,persistent:!0}).onOk(function(){var e=l()(n.a.mark(function e(s){var o,r;return n.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return console.log(">>>> OK, received",s),e.prev=1,e.next=4,i.$axios.post(i.$dbCon.io.io.uri+"/authentication",{email:i.$root.user.email,password:s,strategy:"sso"});case 4:return i.$q.loading.show({message:"Publishing signed draft"}),o={},o["versions.".concat(i.vi,".approvers.").concat(t,".approved")]=!0,o["versions.".concat(i.vi,".approvers.").concat(t,".timestamp")]=Date.now(),e.next=10,i.$dbCon.services["juan-files"].patch(i.node._id,o);case 10:r="approvers",i.node.security[r].map(function(){var e=l()(n.a.mark(function e(t){return n.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,i.$dbCon.services["juan-notifs"].create({from:i.$root.user,to:t.value,action:"Arpproved revision request (".concat(i.node.versions[i.vi].version,")"),access:r,data:i.node,timestamp:Date.now(),seen:!1});case 2:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),i.$dbCon.services["juan-notifs"].create({from:i.$root.user,to:i.node.logs[0].user,action:"Arpproved revision request (".concat(i.node.versions[i.vi].version,")"),access:r,data:i.node,timestamp:Date.now(),seen:!1}),i.$q.loading.hide(),e.next=21;break;case 16:e.prev=16,e.t0=e["catch"](1),console.log(e.t0),i.$q.notify({message:"Wrong Password",position:"bottom-right",color:"negative"}),i.$q.loading.hide();case 21:case"end":return e.stop()}},e,null,[[1,16]])}));return function(t){return e.apply(this,arguments)}}());case 1:case"end":return e.stop()}},e,this)}));function t(t){return e.apply(this,arguments)}return t}(),uploaded:function(){var e=l()(n.a.mark(function e(t){var i,s;return n.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return console.log("UPLOADED Trin"),e.prev=1,i=JSON.parse(t.xhr.response),i=Object.assign(i,this.revision),i.effectivityDate=new Date(this.revision.effectivityDate).getTime(),i.dateUploaded=(new Date).getTime(),i.approvers=this.$lodash.cloneDeep(this.node.security.approvers),s={},s["versions.".concat(this.vi,"._id")]=i._id,e.next=11,this.$dbCon.services["juan-files"].patch(this.node._id,s);case 11:this.file.versions[0]._id=i._id,this.$forceUpdate(),this.$refs.draftUploader.reset(),e.next=19;break;case 16:e.prev=16,e.t0=e["catch"](1),this.$q.notify({message:e.t0.toString(),position:"bottom-right",color:"negative"});case 19:this.$q.loading.hide();case 20:case"end":return e.stop()}},e,this,[[1,16]])}));function t(t){return e.apply(this,arguments)}return t}(),publish:function(){var e=l()(n.a.mark(function e(){var t,i,s,o,r=this;return n.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return t=this.$lodash.cloneDeep(this.node.logs),i={logs:t},i["versions.".concat(this.vi,".approved")]=!0,s={action:"New Version (".concat(this.node.versions[this.vi].version,")"),timestamp:Date.now(),data:this.node,user:this.$root.user},i.logs.push(s),e.next=7,this.$dbCon.services["juan-files"].patch(this.node._id,i);case 7:o=e.sent,this.$root.clickedItem=o,this.$q.notify({message:"Version ".concat(this.node.versions[this.vi].version," published"),position:"bottom-right",color:"positive"}),Object.keys(this.node.security).map(function(e){r.$lodash.isArray(r.node.security[e])&&r.node.security[e].map(function(){var t=l()(n.a.mark(function t(i){return n.a.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,r.$dbCon.services["juan-notifs"].create({from:r.$root.user,to:i.value,action:"Published version ".concat(r.node.versions[r.vi].version," of"),access:e,data:r.node,timestamp:Date.now(),seen:!1});case 2:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}())}),this.$dbCon.services["juan-notifs"].create({from:this.$root.user,to:this.logs[0].user,action:"Published version ".concat(this.node.versions[this.vi].version," of"),access:"owner",data:this.node,timestamp:Date.now(),seen:!1});case 12:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}(),patch:function(){var e=l()(n.a.mark(function e(){var t,i,s,o=this,r=arguments;return n.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return t=r.length>0&&void 0!==r[0]?r[0]:{},i={},s={},Object.assign(s,t),Object.assign(s,this.revision),s.approvers=this.$lodash.cloneDeep(this.node.security.approvers),i["versions.".concat(this.vi,"._id")]=t.id,e.next=9,this.$dbCon.services["juan-files"].patch(this.node._id,i);case 9:this.node.security.approvers.map(function(){var e=l()(n.a.mark(function e(t){return n.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,o.$dbCon.services["juan-notifs"].create({from:o.$root.user,to:t.value,action:"edited a draft",access:"revision",data:o.node,timestamp:Date.now(),seen:!1});case 2:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),this.draftDialog[0].hide(),this.$q.notify({message:"Draft was edited",position:"bottom-right",color:"positive"}),this.$q.loading.hide();case 13:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}(),currentVersion:function(e){var t=null;return t="undefined"===typeof e.versions[0].approved?0:e.versions[0].approved?0:1,e.versions[t]},open:function(e){window.open("".concat(this.$dbCon.io.io.uri,"/uploads?_id=").concat(e),"_blank")}}},V=z,U=Object(m["a"])(V,F,P,!1,null,null,null),M=U.exports,A={props:["node"],components:{uploadDraft:k,editDraft:O,viewDraft:M},data:function(){return{draftDialogIsOpen:!1,editDraftDialogIsOpen:!1,viewDraftDialogIsOpen:!1,draftDialog:null,editDraftDialog:null,viewDraftDialog:null}},methods:{openViewDraftDialog:function(){this.viewDraftDialog=this.$refs.viewDraftDialog,this.viewDraftDialogIsOpen=!0},openEditDraftDialog:function(){this.editDraftDialog=this.$refs.editDraftDialog,this.editDraftDialogIsOpen=!0},openDraftDialog:function(){this.draftDialog=this.$refs.draftDialog,this.draftDialogIsOpen=!0},open:function(e){window.open("".concat(this.$dbCon.io.io.uri,"/uploads?_id=").concat(e),"_blank")}}},E=A,R=Object(m["a"])(E,w,_,!1,null,null,null),T=R.exports,L=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("q-menu",{attrs:{anchor:"top right",self:"top left"}},[i("q-card",{staticStyle:{width:"300px"}},[i("q-card-section",{staticClass:"row"},[i("div",{staticClass:"text-h6 col"},[e._v("Approve Document")]),i("div")]),i("q-card-section",{staticClass:"col"},[i("div",{staticClass:"row"},e._l(e.node.security.approvers.map(function(e){return Object.assign({},{approved:!1},e)}),function(t){return i("q-chip",{key:t._id,attrs:{dense:""}},[i("q-avatar",{attrs:{icon:t.approved?"thumb_up":"watch_later",color:t.approved?"secondary":"grey","text-color":"white"}}),e._v("\r\n          "+e._s(t.label)+"\r\n        ")],1)}),1),i("q-input",{attrs:{dense:"",rounded:"",outlined:"",error:e.isWrongPass,type:e.isPwd?"password":"text"},scopedSlots:e._u([{key:"append",fn:function(){return[i("q-icon",{staticClass:"cursor-pointer",attrs:{name:e.isPwd?"visibility_off":"visibility"},on:{click:function(t){e.isPwd=!e.isPwd}}})]},proxy:!0}]),model:{value:e.password,callback:function(t){e.password=t},expression:"password"}}),i("div",{directives:[{name:"show",rawName:"v-show",value:e.isWrongPass,expression:"isWrongPass"}],staticClass:"q-field__bottom text-negative",staticStyle:{position:"relative",bottom:"20px"}},[e._v("Wrong-Password")])],1),i("q-card-actions",{staticClass:"text-primary",attrs:{align:"right"}},[i("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:"Cancel"}}),i("q-btn",{attrs:{color:"primary",label:"Save",disabled:!e.password},on:{click:e.approve}})],1)],1)],1)},W=[],G=(i("20d6"),{props:["node"],data:function(){return{password:"",isPwd:!0,isWrongPass:!1}},methods:{approve:function(){var e=l()(n.a.mark(function e(){var t,i,s,o=this;return n.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.$axios.post(this.$dbCon.io.io.uri+"/authentication",{strategy:"sso",email:this.$root.user.email,password:this.password});case 3:t=e.sent,console.log("asdasda",t),i=this.$lodash.findIndex(this.node.security.approvers,function(e){return e.value._id===o.$root.user._id}),s={},s["security.approvers.".concat(i,".approved")]=!0,this.$dbCon.services["juan-files"].patch(this.node._id,s),e.next=16;break;case 11:e.prev=11,e.t0=e["catch"](0),console.error(e.t0),this.isWrongPass=!0,setTimeout(function(){o.isWrongPass=!1},5e3);case 16:case"end":return e.stop()}},e,this,[[0,11]])}));function t(){return e.apply(this,arguments)}return t}()}}),J=G,B=Object(m["a"])(J,L,W,!1,null,null,null),K=B.exports,Y={components:{moveTo:g,versionsDialog:T,approveDialog:K},mounted:function(){this.security=d()({},this.security,Object(u["cloneDeep"])(this.node.security)),this.tempNode=this.$lodash.cloneDeep(this.node)},props:["node"],data:function(){return{versionsDialogIsOpen:!1,renameFolderPrompt:!1,tempNode:{label:""},shareDialogIsOpen:!1,searchedUsers:[],security:{public:!1,viewers:[],uploaders:[],modifiers:[],removers:[],folderCreators:[],approvers:[]}}},methods:{open:function(e){e.isFolder?this.$router.push("/myDrive/"+e._id):1===e.versions.length||e.versions[0].approved?window.open("".concat(this.$dbCon.io.io.uri,"/uploads?_id=").concat(e.versions[0]._id),"_blank"):window.open("".concat(this.$dbCon.io.io.uri,"/uploads?_id=").concat(e.versions[1]._id),"_blank")},showRenameModal:function(){this.renameFolderPrompt=!0,this.tempNode=this.$lodash.cloneDeep(this.node)},saveFolder:function(){var e=l()(n.a.mark(function e(){var t,i;return n.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return this.tempNode.security=this.security,t=Date.now(),i={action:"renamed",timestamp:t,data:{new:this.$deepDiff(this.tempNode,this.node),old:this.$deepDiff(this.node,this.tempNode)},user:this.$root.user},e.next=5,this.$dbCon.services[this.node.isFolder?"juan-folders":"juan-files"].patch(this.node._id,{label:this.tempNode.label,logs:this.tempNode.logs.concat([i])});case 5:this.renameFolderPrompt=!1;case 6:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}(),searchUsers:function(){var e=l()(n.a.mark(function e(t,i,s){var o,r=this;return n.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(!(t.length<2)){e.next=3;break}return s(),e.abrupt("return");case 3:return e.next=5,this.$sso.services.users.find({query:{$search:t}});case 5:o=e.sent,console.log(o.data),i(function(){r.searchedUsers=o.data.map(function(e){return delete e.training_programs,delete e.voluntary_work,delete e.work_experience,delete e.civil_service_eligibility,delete e.educational_background,delete e.family_background,delete e.other_information,delete e.extra_information.signature,{label:e.personal_information.first_name+" "+e.personal_information.surname,value:e}})});case 8:case"end":return e.stop()}},e,this)}));function t(t,i,s){return e.apply(this,arguments)}return t}(),saveSecurity:function(){var e=l()(n.a.mark(function e(){var t,i,s,o=this;return n.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return t=this.$deepDiff(this.security,this.node.security),this.tempNode.security=this.security,i=Date.now(),s={action:"Shared",timestamp:i,data:{new:this.$deepDiff(this.tempNode,this.node),old:this.$deepDiff(this.node,this.tempNode)},user:this.$root.user},e.next=6,this.$dbCon.services[this.node.isFolder?"juan-folders":"juan-files"].patch(this.node._id,{security:this.security,logs:this.tempNode.logs.concat([s])});case 6:this.shareDialogIsOpen=!1,Object(u["isEmpty"])(t)||(console.log("Security has Update"),Object.keys(t).map(function(e){console.log(e,t[e]),o.$lodash.isArray(t[e])&&t[e].map(function(){var t=l()(n.a.mark(function t(i){return n.a.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return o.$axios.post("".concat(o.$dbCon.io.io.uri,"/sendMail"),{to:i.value.personal_information.email,subject:"OnlineISO: ".concat(o.node.label),message:"\n                  ".concat(o.$root.user.personal_information.first_name," ").concat(o.$root.user.personal_information.surname,'\n                  shared\n                  <a href="').concat(o.$host,"/#/myDrive/").concat(o.node._id,'">').concat(o.node.label,"</a> ").concat(o.node.isFolder?"folder":"file","\n                "),url:"".concat(o.$host,"/#/myDrive/").concat(o.node._id)},{"Content-Type":"application/json"}),t.next=3,o.$dbCon.services["juan-notifs"].create({from:o.$root.user,to:i.value,action:"shared",access:e,data:o.node,timestamp:Date.now(),seen:!1});case 3:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}())}));case 8:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}(),remove:function(){var e=this;this.$root.clickedItem=this.$root.nodeFormat,this.$q.dialog({title:"Confirm",message:"Would you like to delete this ".concat(this.node.label),ok:{color:"negative"},cancel:{},persistent:!0}).onOk(l()(n.a.mark(function t(){var i,s;return n.a.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return e.$root.clickedItem=e.$root.nodeFormat,e.tempNode.security=e.security,i=Date.now(),s={action:"Trashed",timestamp:i,user:e.$root.user},t.next=6,e.$dbCon.services[e.node.isFolder?"juan-folders":"juan-files"].patch(e.node._id,{trash:!0,logs:e.tempNode.logs.concat([s])});case 6:e.$q.notify({message:e.node.label+" was removed",position:"bottom-left",actions:[{label:"Undo",handler:function(){var t=l()(n.a.mark(function t(){var i,s;return n.a.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return i=Date.now(),s={action:"Recovered",timestamp:i,user:e.$root.user},t.next=4,e.$dbCon.services[e.node.isFolder?"juan-folders":"juan-files"].patch(e.node._id,{trash:!1,logs:e.tempNode.logs.concat([s])});case 4:e.$q.notify({message:e.node.label+" was restored",position:"bottom-left"});case 5:case"end":return t.stop()}},t)}));function i(){return t.apply(this,arguments)}return i}()}]});case 7:case"end":return t.stop()}},t)})))}}},H=Y,Q=Object(m["a"])(H,s,o,!1,null,null,null);t["a"]=Q.exports},"46d1":function(e,t,i){"use strict";var s=i("3e59"),o=i.n(s);o.a}}]);