(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["05ab4153"],{"3e59":function(e,t,o){},"444c":function(e,t,o){"use strict";var i=function(){var e=this,t=e.$createElement,o=e._self._c||t;return e.newDocPrompt||e.signaturePrompt||e.responsesPrompt||e.formPrompt||e.viewFormIsOpen||e.shareDialogIsOpen||e.renameFolderPrompt||e.versionsDialogIsOpen?e.newDocPrompt?o("q-dialog",{ref:"newDocPrompt",attrs:{persistent:""},model:{value:e.newDocPrompt,callback:function(t){e.newDocPrompt=t},expression:"newDocPrompt"}},[e.modifying?o("new-doc",{attrs:{refs:e.$refs,modify:e.node}}):o("new-doc",{attrs:{refs:e.$refs,view:e.node}})],1):e.responsesPrompt?o("q-dialog",{attrs:{persistent:""},model:{value:e.responsesPrompt,callback:function(t){e.responsesPrompt=t},expression:"responsesPrompt"}},[o("juan-responses",{attrs:{node:e.node,userID:e.node.owner!==e.$root.user._id&&e.$root.user._id}})],1):e.signaturePrompt?o("q-dialog",{attrs:{persistent:""},model:{value:e.signaturePrompt,callback:function(t){e.signaturePrompt=t},expression:"signaturePrompt"}},[o("for-signature",{attrs:{node:e.node,userID:e.$root.user._id}})],1):e.viewFormIsOpen?o("q-dialog",{attrs:{persistent:""},model:{value:e.viewFormIsOpen,callback:function(t){e.viewFormIsOpen=t},expression:"viewFormIsOpen"}},[o("view-form",{attrs:{node:e.node}})],1):e.formPrompt?o("q-dialog",{ref:"formPrompt",attrs:{persistent:""},model:{value:e.formPrompt,callback:function(t){e.formPrompt=t},expression:"formPrompt"}},[o("juan-form",{attrs:{refs:e.$refs},model:{value:e.form,callback:function(t){e.form=t},expression:"form"}})],1):e.versionsDialogIsOpen?o("q-dialog",{ref:"versionsDialog",model:{value:e.versionsDialogIsOpen,callback:function(t){e.versionsDialogIsOpen=t},expression:"versionsDialogIsOpen"}},["doc"===e.node.type?o("doc-versions",{attrs:{node:e.node}}):o("versions-dialog",{attrs:{node:e.node}})],1):e.shareDialogIsOpen?o("q-dialog",{attrs:{persistent:""},model:{value:e.shareDialogIsOpen,callback:function(t){e.shareDialogIsOpen=t},expression:"shareDialogIsOpen"}},[o("q-card",{staticStyle:{"min-width":"400px"}},[o("q-card-section",{staticClass:"row"},[o("div",{staticClass:"text-h6 col"},[e._v("Share/Secure")]),o("div",[o("q-btn-toggle",{attrs:{value:e.security.public,size:"xs","toggle-color":"primary",options:[{label:"Private",value:!1},{label:"System-wide",value:"system"},{label:"Public",value:!0}]},model:{value:e.security.public,callback:function(t){e.$set(e.security,"public",t)},expression:"security.public"}})],1)]),o("q-card-section",[o("q-select",{ref:"viewers",attrs:{options:e.searchedUsers,label:"View",multiple:"","use-chips":"","use-input":""},on:{input:function(t){return e.$refs.viewers.updateInputValue("")},filter:e.searchUsers},model:{value:e.security.viewers,callback:function(t){e.$set(e.security,"viewers",t)},expression:"security.viewers"}}),e.node.isFolder?o("q-select",{ref:"uploaders",attrs:{options:e.searchedUsers,label:"Upload",multiple:"","use-chips":"","use-input":""},on:{input:function(t){return e.$refs.uploaders.updateInputValue("")},filter:e.searchUsers},model:{value:e.security.uploaders,callback:function(t){e.$set(e.security,"uploaders",t)},expression:"security.uploaders"}}):e._e(),o("q-select",{ref:"modifiers",attrs:{options:e.searchedUsers,label:"Modify",multiple:"","use-chips":"","use-input":""},on:{input:function(t){return e.$refs.modifiers.updateInputValue("")},filter:e.searchUsers},model:{value:e.security.modifiers,callback:function(t){e.$set(e.security,"modifiers",t)},expression:"security.modifiers"}}),o("q-select",{ref:"removers",attrs:{options:e.searchedUsers,label:"Remove",multiple:"","use-chips":"","use-input":""},on:{input:function(t){return e.$refs.removers.updateInputValue("")},filter:e.searchUsers},model:{value:e.security.removers,callback:function(t){e.$set(e.security,"removers",t)},expression:"security.removers"}}),e.node.isFolder?e._e():o("q-select",{ref:"approvers",attrs:{options:e.searchedUsers,label:"Approvers",multiple:"","use-chips":"","use-input":""},on:{input:function(t){return e.$refs.approvers.updateInputValue("")},filter:e.searchUsers},model:{value:e.security.approvers,callback:function(t){e.$set(e.security,"approvers",t)},expression:"security.approvers"}})],1),o("q-card-actions",{staticClass:"text-primary",attrs:{align:"right"}},[o("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:"Cancel"}}),o("q-btn",{attrs:{color:"primary",label:"Save"},on:{click:e.saveSecurity}})],1)],1)],1):o("q-dialog",{attrs:{persistent:""},model:{value:e.renameFolderPrompt,callback:function(t){e.renameFolderPrompt=t},expression:"renameFolderPrompt"}},[o("q-card",{staticStyle:{"min-width":"400px"}},[o("q-card-section",[o("div",{staticClass:"text-h6"},[e._v(" Rename "+e._s(e.node.isFolder?"folder":"file"))])]),o("q-card-section",[o("q-input",{attrs:{dense:"",autofocus:""},on:{keyup:function(t){if(!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter"))return null;e.newFolderPrompt=!1},focus:function(t){return e.$refs.target.select()}},model:{value:e.tempNode.label,callback:function(t){e.$set(e.tempNode,"label",t)},expression:"tempNode.label"}})],1),o("q-card-actions",{staticClass:"text-primary",attrs:{align:"right"}},[o("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:"Cancel"}}),o("q-btn",{attrs:{color:"primary",label:"Save"},on:{click:e.saveFolder}})],1)],1)],1):o("q-menu",{ref:"nodeMenu",attrs:{"touch-position":""}},[e.node.security?o("q-list",{staticClass:"q-pt-sm q-pb-sm",staticStyle:{"min-width":"200px"},attrs:{dense:""}},[o("q-item",{directives:[{name:"ripple",rawName:"v-ripple"}],attrs:{clickable:""},on:{click:function(t){return e.open(e.node)}}},[o("q-item-section",{attrs:{avatar:""}},[o("q-icon",{attrs:{color:"blue-grey",name:"remove_red_eye"}})],1),o("q-item-section",[e._v("Open")])],1),e.node.type&&"form"===e.node.type?o("q-item",{directives:[{name:"ripple",rawName:"v-ripple"}],attrs:{clickable:""},on:{click:e.showResponses}},[o("q-item-section",{attrs:{avatar:""}},[o("q-icon",{attrs:{color:"blue-grey",name:"data_usage"}})],1),o("q-item-section",[e._v("Responses")])],1):e._e(),e.node.type&&"form"===e.node.type?o("q-item",{directives:[{name:"ripple",rawName:"v-ripple"}],attrs:{clickable:""},on:{click:e.showForSignature}},[o("q-item-section",{attrs:{avatar:""}},[o("q-icon",{staticStyle:{left:"5px"},attrs:{color:"blue-grey",name:"fas fa-signature",size:"18px"}})],1),o("q-item-section",[e._v("for Signature")])],1):e._e(),o("q-separator",{directives:[{name:"show",rawName:"v-show",value:e.$lodash.findIndex(e.node.security.approvers,function(t){return t.value._id===e.$root.user._id})>-1,expression:"$lodash.findIndex(node.security.approvers, user => user.value._id === $root.user._id) > -1"}],staticClass:"q-mt-sm q-mb-sm"}),e.node.security.approvers&&e.node.security.approvers.length?o("q-item",{directives:[{name:"ripple",rawName:"v-ripple"},{name:"show",rawName:"v-show",value:e.$lodash.findIndex(e.node.security.approvers,function(t){return t.value._id===e.$root.user._id})>-1,expression:"$lodash.findIndex(node.security.approvers, user => user.value._id === $root.user._id) > -1"}],attrs:{clickable:""}},[o("q-item-section",{attrs:{avatar:""}},[o("q-icon",{attrs:{color:"blue-grey",name:"thumb_up"}})],1),o("q-item-section",[e._v("Approved\n        ("+e._s(e.node.security.approvers.filter(function(e){return e.approved}).length)+"/"+e._s(e.node.security.approvers.length)+")\n      ")]),e.node.security.approvers.filter(function(e){return!e.approved}).length?o("approve-dialog",{attrs:{node:e.node}}):e._e()],1):e._e(),o("q-separator",{directives:[{name:"show",rawName:"v-show",value:e.$lodash.findIndex(e.node.security.modifiers,function(t){return t.value._id===e.$root.user._id})>-1||e.node.owner===e.$root.user._id,expression:"$lodash.findIndex(node.security.modifiers, user => user.value._id === $root.user._id) > -1 || node.owner === $root.user._id"}],staticClass:"q-mt-sm q-mb-sm"}),o("q-item",{directives:[{name:"show",rawName:"v-show",value:e.$lodash.findIndex(e.node.security.modifiers,function(t){return t.value._id===e.$root.user._id})>-1||e.node.owner===e.$root.user._id,expression:"$lodash.findIndex(node.security.modifiers, user => user.value._id === $root.user._id) > -1 || node.owner === $root.user._id"},{name:"ripple",rawName:"v-ripple"}],attrs:{clickable:""},on:{click:function(t){e.shareDialogIsOpen=!0}}},[o("q-item-section",{attrs:{avatar:""}},[o("q-icon",{attrs:{color:"blue-grey",name:"share"}})],1),o("q-item-section",[e._v("Share/Secure")])],1),o("q-item",{directives:[{name:"show",rawName:"v-show",value:e.$lodash.findIndex(e.node.security.modifiers,function(t){return t.value._id===e.$root.user._id})>-1||e.node.owner===e.$root.user._id,expression:"$lodash.findIndex(node.security.modifiers, user => user.value._id === $root.user._id) > -1 || node.owner === $root.user._id"},{name:"ripple",rawName:"v-ripple"}],attrs:{clickable:""}},[o("q-item-section",{attrs:{avatar:""}},[o("q-icon",{attrs:{color:"blue-grey",name:"subdirectory_arrow_right"}})],1),o("q-item-section",[e._v("Move to")]),o("move-to",{attrs:{node:e.node}})],1),o("q-item",{directives:[{name:"show",rawName:"v-show",value:e.$lodash.findIndex(e.node.security.modifiers,function(t){return t.value._id===e.$root.user._id})>-1||e.node.owner===e.$root.user._id,expression:"$lodash.findIndex(node.security.modifiers, user => user.value._id === $root.user._id) > -1 || node.owner === $root.user._id"},{name:"ripple",rawName:"v-ripple"}],attrs:{clickable:""},on:{click:e.showRenameModal}},[o("q-item-section",{attrs:{avatar:""}},[o("q-icon",{attrs:{color:"blue-grey",name:"edit"}})],1),o("q-item-section",[e._v("Rename")])],1),e.node.type&&["form","doc"].includes(e.node.type)&&(e.node.owner===e.$root.user._id||e.$lodash.findIndex(e.node.security.modifiers,function(t){return t.value._id===e.$root.user._id})>-1)?o("q-item",{directives:[{name:"ripple",rawName:"v-ripple"}],attrs:{clickable:""},on:{click:function(t){return e.modify(e.node)}}},[o("q-item-section",{attrs:{avatar:""}},[o("q-icon",{staticStyle:{position:"relative",left:"4px"},attrs:{color:"blue-grey",name:"fas fa-edit",size:"20px"}})],1),o("q-item-section",[e._v("Modify")])],1):e._e(),e.node.isFolder||"doc"!==e.node.type?!e.node.isFolder&&e.node.versions?o("q-item",{directives:[{name:"ripple",rawName:"v-ripple"}],attrs:{clickable:""},on:{click:function(t){e.versionsDialogIsOpen=!0}}},[o("q-item-section",{attrs:{avatar:""}},[o("q-icon",{attrs:{color:"blue-grey",name:"color_lens"}})],1),o("q-item-section",[e._v("Versions")])],1):e._e():o("q-item",{directives:[{name:"ripple",rawName:"v-ripple"}],attrs:{clickable:""},on:{click:function(t){e.versionsDialogIsOpen=!0}}},[o("q-item-section",{attrs:{avatar:""}},[o("q-icon",{attrs:{color:"blue-grey",name:"color_lens"}})],1),o("q-item-section",[e._v("Versions")]),e.node.draft?o("q-item-section",[o("q-chip",{attrs:{dense:"",color:"deep-orange","text-color":"white",label:" Draft"}})],1):e._e()],1),o("q-separator",{staticClass:"q-mt-sm q-mb-sm"}),o("q-item",{directives:[{name:"close-popup",rawName:"v-close-popup"},{name:"show",rawName:"v-show",value:e.$lodash.findIndex(e.node.security.removers,function(t){return t.value._id===e.$root.user._id})>-1||e.node.owner===e.$root.user._id,expression:"$lodash.findIndex(node.security.removers, user => user.value._id === $root.user._id) > -1 || node.owner === $root.user._id"},{name:"ripple",rawName:"v-ripple"}],attrs:{clickable:""},on:{click:e.remove}},[o("q-item-section",{attrs:{avatar:""}},[o("q-icon",{attrs:{color:"blue-grey",name:"delete_outline"}})],1),o("q-item-section",[e._v("Remove")])],1)],1):e._e()],1)},s=[],n=(o("ac6a"),o("cadf"),o("06db"),o("456d"),o("7514"),o("967e")),r=o.n(n),a=(o("96cf"),o("fa84")),l=o.n(a),c=o("02fa"),d=o.n(c),u=o("2ef0"),p=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("q-menu",{attrs:{anchor:"top right",self:"top left"}},[o("q-toolbar",{staticClass:"bg-grey-3 text-grey-14",staticStyle:{"min-height":"32px !important"}},["My Drive"!==e.parentNode.label?o("q-btn",{attrs:{flat:"",round:"",dense:"",size:"sm",icon:"arrow_back"},on:{click:e.previousFolder}}):e._e(),o("div",{staticClass:"col text-center"},[e._v("\n      "+e._s(e.parentNode.label)+"\n    ")])],1),o("q-separator"),o("div",{staticStyle:{height:"120px","overflow-y":"scroll"}},[o("q-list",{staticStyle:{width:"250px"},attrs:{dense:""}},e._l(e.folders.filter(function(t){return t._id!==e.node._id}),function(t){return o("q-item",{directives:[{name:"ripple",rawName:"v-ripple"}],key:t._id,attrs:{clickable:"",active:t._id===e.activeNode._id,"active-class":"bg-light-blue text-white"},on:{click:function(o){e.activeNode=Object.assign({},t)},dblclick:function(o){return e.dblClickFolder(t)}}},[o("q-item-section",{attrs:{avatar:""}},[o("q-btn",{attrs:{round:"",size:"sm",flat:""}},[o("q-icon",{attrs:{color:t._id===e.activeNode._id?"white":"blue-grey",name:"folder_open",size:"sm"}})],1)],1),o("q-item-section",[o("span",{staticClass:"limited-text"},[e._v("\n            "+e._s(t.label)+"\n          ")])])],1)}),1)],1),o("q-separator"),o("div",{staticClass:"row q-pa-sm"},[o("div",{staticClass:"col"},[e.$lodash.isEmpty(e.activeNode)?o("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{color:"primary",disabled:e.node.parentFolder===e.parentNode._id},on:{click:e.move}},[e._v("Move here")]):o("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{color:"primary"},on:{click:e.move}},[e._v("Move")])],1),o("q-btn",{attrs:{flat:"",round:"","text-color":"grey-14",icon:"create_new_folder"}})],1)],1)},v=[],f={data:function(){return{parentNode:{label:"...",parentFolder:"My Drive",_id:"My Drive"},folders:[],activeNode:{},tempNode:{}}},props:["node"],mounted:function(){this.getParentFolders(this.node),this.tempNode=this.$lodash.cloneDeep(this.node)},methods:{move:function(){var e=l()(r.a.mark(function e(){var t,o,i,s,n=this;return r.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(t=this.node.parentFolder,o=null,!this.$lodash.isEmpty(this.activeNode)){e.next=11;break}return this.tempNode.parentFolder=this.parentNode._id,i={action:"Moved",timestamp:Date.now(),data:{new:this.$deepDiff(this.tempNode,this.node),old:this.$deepDiff(this.node,this.tempNode)},user:this.$root.user},console.log("LOG",i),e.next=8,this.$dbCon.services[this.node.isFolder?"juan-folders":"juan-files"].patch(this.node._id,{parentFolder:this.parentNode._id,logs:this.node.logs.concat([i])});case 8:o=this.parentNode,e.next=17;break;case 11:return this.tempNode.parentFolder=this.activeNode._id,s={action:"Moved",timestamp:Date.now(),data:{new:this.$deepDiff(this.tempNode,this.node),old:this.$deepDiff(this.node,this.tempNode)},user:this.$root.user},console.log("LOG",s),e.next=16,this.$dbCon.services[this.node.isFolder?"juan-folders":"juan-files"].patch(this.node._id,{parentFolder:this.activeNode._id,logs:this.node.logs.concat([s])});case 16:o=this.activeNode;case 17:this.$q.notify({message:this.node.label+"was moved to "+o.label,position:"bottom-left",actions:[{label:"Undo",handler:function(){var e=l()(r.a.mark(function e(){return r.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,n.$dbCon.services[n.node.isFolder?"juan-folders":"juan-files"].patch(n.node._id,{parentFolder:t});case 2:case"end":return e.stop()}},e)}));function o(){return e.apply(this,arguments)}return o}()}]});case 18:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}(),previousFolder:function(){var e=l()(r.a.mark(function e(t){return r.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.getParentFolders(this.parentNode);case 2:this.activeNode={},console.log("April 30",this.activeNode._id===this.parentNode._id,this.node.parentFolder===this.parentNode._id);case 4:case"end":return e.stop()}},e,this)}));function t(t){return e.apply(this,arguments)}return t}(),dblClickFolder:function(){var e=l()(r.a.mark(function e(t){var o,i,s,n;return r.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return this.parentNode=d()({},t),console.log(t),o=this.$root.global,i=o.condition,s=o.$or,e.next=5,this.$dbCon.services["juan-folders"].find({query:d()({$limit:500,parentFolder:t._id},i,{$or:s})});case 5:n=e.sent,this.folders=n.data,this.activeNode={};case 8:case"end":return e.stop()}},e,this)}));function t(t){return e.apply(this,arguments)}return t}(),getParentFolders:function(){var e=l()(r.a.mark(function e(t){var o,i,s;return r.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(console.log(t),"My Drive"!==t.parentFolder){e.next=5;break}this.parentNode={label:"My Drive",parentFolder:"My Drive",_id:"My Drive"},e.next=8;break;case 5:return e.next=7,this.$dbCon.services["juan-folders"].get(t.parentFolder);case 7:this.parentNode=e.sent;case 8:return o={$sort:{"logs.0.timestamp":-1},trash:{$ne:!0}},i=[{"security.public":!0},{"security.public":{$ne:!1}},{owner:this.$root.user._id},{"security.viewers":{$elemMatch:{"value._id":this.$root.user._id}}},{"security.uploaders":{$elemMatch:{"value._id":this.$root.user._id}}},{"security.modifiers":{$elemMatch:{"value._id":this.$root.user._id}}},{"security.removers":{$elemMatch:{"value._id":this.$root.user._id}}},{"security.folderCreators":{$elemMatch:{"value._id":this.$root.user._id}}},{"security.approvers":{$elemMatch:{"value._id":this.$root.user._id}}}],e.next=12,this.$dbCon.services["juan-folders"].find({query:d()({$limit:500,parentFolder:t.parentFolder},o,{$or:i})});case 12:s=e.sent,this.folders=s.data;case 14:case"end":return e.stop()}},e,this)}));function t(t){return e.apply(this,arguments)}return t}()}},m=f,h=(o("46d1"),o("2877")),g=Object(h["a"])(m,p,v,!1,null,null,null),b=g.exports,_=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("q-card",{staticStyle:{"min-width":"400px"}},[o("q-card-section",{staticClass:"row"},[o("div",{staticClass:"text-h6 col"},[e._v("Manage Version")]),o("div",[e.node.security.approvers&&(1===e.node.versions.length||e.node.versions[0].approved)&&e.node.owner===e.$root.user._id||e.$lodash.findIndex(e.node.security.modifiers,function(t){return t.value._id===e.$root.user._id})>-1?o("q-btn",{attrs:{label:"Request Change"},on:{click:e.openDraftDialog}}):e._e(),o("q-dialog",{ref:"draftDialog",attrs:{persistent:""},model:{value:e.draftDialogIsOpen,callback:function(t){e.draftDialogIsOpen=t},expression:"draftDialogIsOpen"}},[o("upload-draft",{attrs:{draftDialog:e.draftDialog,node:e.node}})],1)],1)]),o("q-card-section",{staticClass:"col"},[o("q-list",{staticClass:"q-pt-sm q-pb-sm",staticStyle:{"min-width":"200px"},attrs:{dense:""}},[1===e.node.versions.length?o("q-item",{directives:[{name:"ripple",rawName:"v-ripple"}],attrs:{clickable:""}},[o("q-item-section",{attrs:{avatar:""}},[o("q-icon",{attrs:{color:"blue-grey",name:"history"}})],1),o("q-item-section",[o("q-item-label",{attrs:{lines:"1"}},[e._v(e._s(e.node.versions[0].version))]),o("q-item-label",{attrs:{caption:""}},[e._v(e._s(e.node.versions[0].dateUploaded))])],1)],1):o("span",e._l(e.node.versions,function(t,i){return o("q-item",{directives:[{name:"ripple",rawName:"v-ripple"}],key:"ver"+i,attrs:{clickable:""}},[o("q-item-section",{attrs:{avatar:""}},[o("q-icon",{attrs:{color:"blue-grey",name:"history"}})],1),o("q-item-section",[o("q-item-label",{attrs:{lines:"1"}},[e._v(e._s(t.version))]),o("q-item-label",{attrs:{caption:""}},[e._v(e._s(e.$moment(t.dateUploaded).format("lll")))])],1),t.approved||0!==i?e._e():o("q-item-section",{attrs:{side:""}},[o("q-chip",{attrs:{color:"deep-orange","text-color":"white",icon:"thumbs_up_down"}},[e._v("\n              Change Request\n            ")])],1),["doc"].includes(e.node.type)||t.approved||0!==i||t.initiator!==e.$root.user._id?e._e():o("q-item-section",{attrs:{side:""}},[o("q-btn",{attrs:{icon:"edit",round:"",size:"sm"},on:{click:e.openEditDraftDialog}}),o("q-dialog",{ref:"editDraftDialog",refInFor:!0,attrs:{persistent:""},model:{value:e.editDraftDialogIsOpen,callback:function(t){e.editDraftDialogIsOpen=t},expression:"editDraftDialogIsOpen"}},[o("edit-draft",{attrs:{draftDialog:e.editDraftDialog,node:e.node,vi:i}})],1)],1),!["doc"].includes(e.node.type)&&i!==e.node.versions.length-1&&(e.$lodash.findIndex(e.node.security.approvers,function(t){return t.value._id===e.$root.user._id})>-1||e.node.logs[0].user._id===e.$root.user._id)?o("q-item-section",{attrs:{side:""}},[o("q-dialog",{ref:"viewDraftDialog",refInFor:!0,attrs:{persistent:""},model:{value:e.viewDraftDialogIsOpen,callback:function(t){e.viewDraftDialogIsOpen=t},expression:"viewDraftDialogIsOpen"}},[o("view-draft",{attrs:{draftDialog:e.viewDraftDialog,node:e.node,vi:i}})],1),o("q-btn",{attrs:{icon:"search",round:"",size:"sm"},on:{click:e.openViewDraftDialog}})],1):e._e(),["doc"].includes(e.node.type)||!t.approved&&0===i?e._e():o("q-item-section",{attrs:{side:""}},[o("q-btn",{attrs:{icon:"cloud_download",round:"",size:"sm"},on:{click:function(o){return e.open(t._id)}}})],1)],1)}),1)],1)],1)],1)},w=[],y=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("q-card",{staticStyle:{"min-width":"80vw"}},[o("q-card-section",{staticClass:"row"},[o("div",{staticClass:"text-h6 col"},[e._v("Change Request")]),o("div",[o("q-btn",{attrs:{dense:"",round:"",icon:"close"},on:{click:e.close}})],1)]),o("q-card-section",{staticClass:"col"},[o("div",{staticClass:"row"},[o("div",{staticClass:"col"},[o("div",{staticClass:"row q-gutter-md"},[o("q-input",{staticClass:"col-xs-11 col-sm-11 col-md col-lg col-xl-4",attrs:{label:"Code",autofocus:""},model:{value:e.revision.code,callback:function(t){e.$set(e.revision,"code",t)},expression:"revision.code"}}),o("q-input",{attrs:{label:"Previous version"},model:{value:e.revision.previousVersion,callback:function(t){e.$set(e.revision,"previousVersion",t)},expression:"revision.previousVersion"}}),o("q-input",{attrs:{label:"New version"},model:{value:e.revision.version,callback:function(t){e.$set(e.revision,"version",t)},expression:"revision.version"}})],1),o("div",{staticClass:"row q-gutter-md"},[o("q-input",{staticClass:"col-xs-11 col-sm-11 col-md col-lg col-xl-4",attrs:{label:"Title"},model:{value:e.revision.title,callback:function(t){e.$set(e.revision,"title",t)},expression:"revision.title"}}),o("q-input",{staticStyle:{position:"relative",top:"10px"},attrs:{label:"Effectivity Date",mask:"date",rules:["date"]},scopedSlots:e._u([{key:"append",fn:function(){return[o("q-icon",{staticClass:"cursor-pointer",attrs:{name:"event"}},[o("q-popup-proxy",{ref:"qDateProxy",attrs:{"transition-show":"scale","transition-hide":"scale"}},[o("q-date",{on:{input:function(){return e.$refs.qDateProxy.hide()}},model:{value:e.revision.effectivityDate,callback:function(t){e.$set(e.revision,"effectivityDate",t)},expression:"revision.effectivityDate"}})],1)],1)]},proxy:!0}]),model:{value:e.revision.effectivityDate,callback:function(t){e.$set(e.revision,"effectivityDate",t)},expression:"revision.effectivityDate"}})],1)])]),o("div",{staticClass:"col q-pt-md q-gutter-md"},[o("div",[e._v("Reason")]),o("q-editor",{attrs:{"min-height":"5rem",toolbar:e.toolbar,fonts:e.fonts},model:{value:e.revision.reason,callback:function(t){e.$set(e.revision,"reason",t)},expression:"revision.reason"}}),o("div",[e._v("Details")]),o("q-editor",{attrs:{"min-height":"5rem",toolbar:e.toolbar,fonts:e.fonts},model:{value:e.revision.details,callback:function(t){e.$set(e.revision,"details",t)},expression:"revision.details"}})],1),o("q-card-actions",{staticClass:"text-primary",attrs:{align:"right"}},[o("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:"Cancel"}}),o("q-btn",{attrs:{disabled:!e.revision.reason||!e.revision.details||!e.revision.version,color:"primary",label:"Submit"},on:{click:e.submit}})],1)],1)],1)},$=[],q=(o("6b54"),o("f751"),o("28a5"),{props:["draftDialog","node"],mounted:function(){var e=this;this.$nextTick(function(){e.draftUploader=e.$refs.draftUploader})},data:function(){var e=this.currentVersion(this.node);console.log("currentVersion",e);var t="",o="";if("undefined"!==typeof e.previousVersion){t=e.version;var i=e.version.split(".");++i[i.length-1],o=i.join(".")}else"undefined"===typeof e.previousVersion&&(t=e.version,o="0.0.0");return{draftUploader:{files:[]},jwt:window.localStorage.getItem("".concat(this.$dbCon.io.io.uri,"-jwt")),revision:{effectivityDate:null,code:"",title:this.node.label,previousVersion:t,version:o,reason:"",details:"",initiator:this.$root.user._id,approved:!1},toolbar:[["left","center","right","justify"],["bold","italic","strike","underline","subscript","superscript"],["token","hr","link","custom_btn"],[{label:this.$q.lang.editor.formatting,icon:this.$q.iconSet.editor.formatting,list:"no-icons",options:["p","h1","h2","h3","h4","h5","h6","code"]},{label:this.$q.lang.editor.fontSize,icon:this.$q.iconSet.editor.fontSize,fixedLabel:!0,fixedIcon:!0,list:"no-icons",options:["size-1","size-2","size-3","size-4","size-5","size-6","size-7"]},{label:this.$q.lang.editor.defaultFont,icon:this.$q.iconSet.editor.font,fixedIcon:!0,list:"no-icons",options:["default_font","arial","arial_black","comic_sans","courier_new","impact","lucida_grande","times_new_roman","verdana"]},"removeFormat"],["quote","unordered","ordered","outdent","indent"],["undo","redo"],["print","fullscreen"]],fonts:{arial:"Arial",arial_black:"Arial Black",comic_sans:"Comic Sans MS",courier_new:"Courier New",impact:"Impact",lucida_grande:"Lucida Grande",times_new_roman:"Times New Roman",verdana:"Verdana"}}},methods:{close:function(){this.draftDialog.hide()},submit:function(){var e=l()(r.a.mark(function e(){var t,o,i,s,n=this;return r.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return this.$q.loading.show({message:"Submitting Draft ".concat(this.revision.version)}),e.prev=1,t=this.$lodash.cloneDeep(this.node.versions),o=Object.assign({},this.revision),o.effectivityDate=new Date(this.revision.effectivityDate).getTime(),o.approvers=this.$lodash.cloneDeep(this.node.security.approvers).map(function(e){return e.approved=!1,e}),t.unshift(o),i=this.$lodash.cloneDeep(this.node.logs),s={action:"Revision Requested",timestamp:Date.now(),data:o,user:this.$root.user},i.push(s),e.next=12,this.$dbCon.services["juan-files"].patch(this.node._id,{versions:t,logs:i});case 12:o.approvers.map(function(){var e=l()(r.a.mark(function e(t){var o;return r.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return o="",o=n.node.isFolder?n.$host+"/#/myDrive/"+n.node._id:n.$host+"/#/myDrive/"+n.node.parentFolder+"?f="+n.node._id,n.$axios.post("".concat(n.$dbCon.io.io.uri,"/sendMail"),{to:t.value.personal_information.email,subject:"OnlineISO: ".concat(n.node.label),message:"\n              ".concat(n.$root.user.personal_information.first_name," ").concat(n.$root.user.personal_information.surname,'\n              requested a change request\n              <a href="').concat(o,'">').concat(n.node.label,"</a> ").concat(n.node.isFolder?"folder":"file","\n            "),url:"".concat(o),html:{firstName:t.value.personal_information.first_name,message:"\n                ".concat(n.$root.user.personal_information.first_name," ").concat(n.$root.user.personal_information.surname,"\n                requested a change request\n              "),url:{text:'Open "'+n.node.label+'"',link:o}}},{"Content-Type":"application/json"}),e.next=5,n.$dbCon.services["juan-notifs"].create({from:n.$root.user,to:t.value,action:"Revision requested",access:"revision",data:n.node,timestamp:Date.now(),seen:!1});case 5:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),this.draftDialog.hide(),this.$q.notify({message:"Revision requested",position:"bottom-right",color:"positive"}),e.next=20;break;case 17:e.prev=17,e.t0=e["catch"](1),this.$q.notify({message:e.t0.toString(),position:"bottom-right",color:"negative"});case 20:this.$q.loading.hide();case 21:case"end":return e.stop()}},e,this,[[1,17]])}));function t(){return e.apply(this,arguments)}return t}(),currentVersion:function(e){var t=null;return t="undefined"===typeof e.versions[0].approved?0:e.versions[0].approved?0:1,e.versions[t]}}}),D=q,x=Object(h["a"])(D,y,$,!1,null,null,null),k=x.exports,C=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("q-card",{staticStyle:{"min-width":"80vw"}},[o("q-card-section",{staticClass:"row"},[o("div",{staticClass:"text-h6 col"},[e._v("Edit Draft")]),o("div",[o("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{dense:"",round:"",icon:"close"}})],1)]),o("q-card-section",{staticClass:"col"},[o("div",{staticClass:"row"},[o("div",{staticClass:"col"},[o("div",{staticClass:"row q-gutter-md"},[o("q-input",{staticClass:"col-xs-11 col-sm-11 col-md col-lg col-xl-4",attrs:{label:"Code",autofocus:""},model:{value:e.revision.code,callback:function(t){e.$set(e.revision,"code",t)},expression:"revision.code"}}),o("q-input",{attrs:{label:"Previous version"},model:{value:e.revision.previousVersion,callback:function(t){e.$set(e.revision,"previousVersion",t)},expression:"revision.previousVersion"}}),o("q-input",{attrs:{label:"New version"},model:{value:e.revision.version,callback:function(t){e.$set(e.revision,"version",t)},expression:"revision.version"}})],1),o("div",{staticClass:"row q-gutter-md"},[o("q-input",{staticClass:"col-xs-11 col-sm-11 col-md col-lg col-xl-4",attrs:{label:"Title"},model:{value:e.revision.title,callback:function(t){e.$set(e.revision,"title",t)},expression:"revision.title"}}),o("q-input",{staticStyle:{position:"relative",top:"10px"},attrs:{label:"Effectivity Date",mask:"date",rules:["date"]},scopedSlots:e._u([{key:"append",fn:function(){return[o("q-icon",{staticClass:"cursor-pointer",attrs:{name:"event"}},[o("q-popup-proxy",{ref:"qDateProxy",attrs:{"transition-show":"scale","transition-hide":"scale"}},[o("q-date",{on:{input:function(){return e.$refs.qDateProxy.hide()}},model:{value:e.revision.effectivityDate,callback:function(t){e.$set(e.revision,"effectivityDate",t)},expression:"revision.effectivityDate"}})],1)],1)]},proxy:!0}]),model:{value:e.revision.effectivityDate,callback:function(t){e.$set(e.revision,"effectivityDate",t)},expression:"revision.effectivityDate"}})],1)])]),o("div",{staticClass:"col q-pt-md q-gutter-md"},[o("div",[e._v("Reason")]),o("q-editor",{attrs:{"min-height":"5rem",toolbar:e.toolbar,fonts:e.fonts},model:{value:e.revision.reason,callback:function(t){e.$set(e.revision,"reason",t)},expression:"revision.reason"}}),o("div",[e._v("Details")]),o("q-editor",{attrs:{"min-height":"5rem",toolbar:e.toolbar,fonts:e.fonts},model:{value:e.revision.details,callback:function(t){e.$set(e.revision,"details",t)},expression:"revision.details"}})],1),o("q-card-actions",{staticClass:"text-primary",attrs:{align:"right"}},[o("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:"Cancel"}}),o("q-btn",{attrs:{disabled:!e.revision.reason||!e.revision.details||!e.revision.version,color:"primary",label:"Submit"},on:{click:e.submit}})],1)],1)],1)},S=[],I={props:["draftDialog","node","vi"],mounted:function(){var e=this;this.$nextTick(function(){e.draftUploader=e.$refs.draftUploader,console.log("mounted this.draftUploader",e.draftUploader)})},data:function(){return{file:this.node,draftUploader:{files:[]},jwt:window.localStorage.getItem("".concat(this.$dbCon.io.io.uri,"-jwt")),revision:{effectivityDate:this.node.versions[this.vi].effectivityDate,code:this.node.versions[this.vi].code,title:this.node.versions[this.vi].title,previousVersion:this.node.versions[this.vi].previousVersion,version:this.node.versions[this.vi].version,reason:this.node.versions[this.vi].reason,details:this.node.versions[this.vi].details,initiator:this.node.versions[this.vi].initiator,approved:this.node.versions[this.vi].approved},toolbar:[["left","center","right","justify"],["bold","italic","strike","underline","subscript","superscript"],["token","hr","link","custom_btn"],[{label:this.$q.lang.editor.formatting,icon:this.$q.iconSet.editor.formatting,list:"no-icons",options:["p","h1","h2","h3","h4","h5","h6","code"]},{label:this.$q.lang.editor.fontSize,icon:this.$q.iconSet.editor.fontSize,fixedLabel:!0,fixedIcon:!0,list:"no-icons",options:["size-1","size-2","size-3","size-4","size-5","size-6","size-7"]},{label:this.$q.lang.editor.defaultFont,icon:this.$q.iconSet.editor.font,fixedIcon:!0,list:"no-icons",options:["default_font","arial","arial_black","comic_sans","courier_new","impact","lucida_grande","times_new_roman","verdana"]},"removeFormat"],["quote","unordered","ordered","outdent","indent"],["undo","redo"],["print","fullscreen"]],fonts:{arial:"Arial",arial_black:"Arial Black",comic_sans:"Comic Sans MS",courier_new:"Courier New",impact:"Impact",lucida_grande:"Lucida Grande",times_new_roman:"Times New Roman",verdana:"Verdana"}}},methods:{close:function(){console.log("this.draftDialog",this.draftDialog),this.draftDialog[0].hide()},submit:function(){this.$q.loading.show({message:"Submitting Draft ".concat(this.revision.version)}),this.patch()},uploaded:function(){var e=l()(r.a.mark(function e(t){var o;return r.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:console.log("UPLOADED");try{o=JSON.parse(t.xhr.response),o=Object.assign(o,this.revision),o.effectivityDate=new Date(this.revision.effectivityDate).getTime(),o.dateUploaded=(new Date).getTime(),o.approvers=this.$lodash.cloneDeep(this.node.security.approvers),this.$dbCon.service("uploads").patch(o._id,{parentNode:this.node._id}),console.log("file",o),this.patch(o)}catch(i){this.$q.notify({message:i.toString(),position:"bottom-right",color:"negative"})}this.$q.loading.hide();case 3:case"end":return e.stop()}},e,this)}));function t(t){return e.apply(this,arguments)}return t}(),patch:function(){var e=l()(r.a.mark(function e(){var t,o,i,s,n,a=this,c=arguments;return r.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return t=c.length>0&&void 0!==c[0]?c[0]:{},o={},i={},Object.assign(i,t),Object.assign(i,this.revision),i.approvers=this.$lodash.cloneDeep(this.node.security.approvers),o["versions.".concat(this.vi)]=i,s=this.node.versions[this.vi],n={action:"Change Request Update",timestamp:Date.now(),data:{new:this.$deepDiff(s,i),old:this.$deepDiff(i,s)},user:this.$root.user},o["logs"]=this.node.logs.concat([n]),e.next=12,this.$dbCon.services["juan-files"].patch(this.node._id,o);case 12:this.node.security.approvers.map(function(){var e=l()(r.a.mark(function e(t){var o;return r.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return o="",o=a.node.isFolder?a.$host+"/#/myDrive/"+a.node._id:a.$host+"/#/myDrive/"+a.node.parentFolder+"?f="+a.node._id,a.$axios.post("".concat(a.$dbCon.io.io.uri,"/sendMail"),{to:t.value.personal_information.email,subject:"OnlineISO: ".concat(a.node.label),message:"\n            ".concat(a.$root.user.personal_information.first_name," ").concat(a.$root.user.personal_information.surname,'\n            edited a change request\n            <a href="').concat(o,'">').concat(a.node.label,"</a> ").concat(a.node.isFolder?"folder":"file","\n          "),url:"".concat(o),html:{firstName:t.value.personal_information.first_name,message:"\n              ".concat(a.$root.user.personal_information.first_name," ").concat(a.$root.user.personal_information.surname,"\n              notified you to sign the Change Request\n            "),url:{text:'Open "'+a.node.label+'"',link:o}}},{"Content-Type":"application/json"}),e.next=5,a.$dbCon.services["juan-notifs"].create({from:a.$root.user,to:t.value,action:"edited a draft",access:"revision",data:a.node,timestamp:Date.now(),seen:!1});case 5:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),this.draftDialog[0].hide(),this.$q.notify({message:"Change request was edited",position:"bottom-right",color:"positive"}),this.$q.loading.hide();case 16:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}(),currentVersion:function(e){var t=null;return t="undefined"===typeof e.versions[0].approved?0:e.versions[0].approved?0:1,e.versions[t]},open:function(e){window.open("".concat(this.$dbCon.io.io.uri,"/uploads?_id=").concat(e),"_blank")}}},N=I,O=Object(h["a"])(N,C,S,!1,null,null,null),F=O.exports,j=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("q-card",{staticStyle:{"min-width":"80vw"}},[o("q-card-section",{staticClass:"row"},[o("div",{staticClass:"text-h6 col"},[e._v("Change Request "+e._s(e.file.versions[e.vi].approved?"Published":""))]),o("div",[o("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{dense:"",round:"",icon:"close"}})],1)]),o("q-card-section",{staticClass:"col"},[o("div",{staticClass:"row"},[e.file.versions[e.vi].initiator===e.$root.user._id?o("div",{staticClass:"col-xs-12 col-sm col-md-4 col-lg-4 col-xl-4 q-mr-md"},[e.file.versions[e.vi]._id?o("q-card",{key:e.file.versions[e.vi]._id,staticClass:"no-shadow",attrs:{bordered:""}},[e.file.versions&&e.$lodash.isImage(e.file.versions[e.vi].fileName)?o("div",{staticClass:"thumbnail"},[o("img",{staticClass:"portrait",attrs:{src:e.$dbCon.io.io.uri+"/uploads?_id="+e.file.versions[e.vi]._id,alt:"Image"}})]):e.$lodash.isVideo(e.file.versions[e.vi].fileName)?o("div",{staticClass:"thumbnail"},[o("video",{staticClass:"thumbnail",attrs:{controls:"",preload:"none"}},[o("source",{attrs:{src:e.$dbCon.io.io.uri+"/uploads?_id="+e.file.versions[e.vi]._id}}),e._v("\n              Your browser does not support the video tag.\n            ")])]):o("div",{staticClass:"row justify-center bg-blue-grey-1"},[o("q-icon",{staticClass:"q-pt-md q-pb-md",attrs:{name:"insert_drive_file",size:"72px",color:"blue-grey-14 thumbnail"}})],1),o("q-card-section",{staticClass:"row items-center no-wrap",staticStyle:{"max-height":"56px"}},[o("div",{staticClass:"col text-weight-regular limited-text",class:{"text-primary":e.$root.clickedItem._id===e.file._id,"text-blue-grey-14":e.$root.clickedItem._id!==e.file._id}},[o("q-btn",{staticClass:"bg-white q-mr-sm",attrs:{round:"",flat:"",color:"blue-grey-14",size:"sm",icon:"insert_drive_file"}}),o("span",[e._v("\n                "+e._s(e.file.label)+"\n                "),e.file.label.length>25?o("q-tooltip",[e._v("\n                  "+e._s(e.file.label)+"\n                ")]):e._e()],1)],1),o("div",{staticClass:"col-auto"},[o("q-btn",{staticClass:"no-shadow text-grey-7",attrs:{round:"",icon:"cloud_download",color:"grey-11",size:"sm"},on:{click:function(t){return e.open(e.file.versions[e.vi]._id)}}})],1)])],1):e._e(),e.file.versions[e.vi].approved||e.node.owner!==e.$root.user._id?e._e():o("div",{staticClass:"row"},[o("q-uploader",{ref:"draftUploader",staticClass:"col",attrs:{headers:[{name:"Authorization",value:e.jwt}],url:e.$dbCon.io.io.uri+"/uploads","field-name":"file"},on:{uploaded:e.uploaded}})],1)],1):e._e(),o("div",{staticClass:"col"},[o("div",{staticClass:"row q-gutter-md"},[o("q-input",{staticClass:"col-xs-11 col-sm-11 col-md col-lg col-xl-4",attrs:{label:"Code",autofocus:"",readonly:""},model:{value:e.revision.code,callback:function(t){e.$set(e.revision,"code",t)},expression:"revision.code"}}),o("q-input",{attrs:{label:"Previous version",readonly:""},model:{value:e.revision.previousVersion,callback:function(t){e.$set(e.revision,"previousVersion",t)},expression:"revision.previousVersion"}}),o("q-input",{attrs:{label:"New version",readonly:""},model:{value:e.revision.version,callback:function(t){e.$set(e.revision,"version",t)},expression:"revision.version"}})],1),o("div",{staticClass:"row q-gutter-md"},[o("q-input",{staticClass:"col-xs-11 col-sm-11 col-md col-lg col-xl-4",attrs:{readonly:"",label:"Title"},model:{value:e.revision.title,callback:function(t){e.$set(e.revision,"title",t)},expression:"revision.title"}}),o("q-input",{staticStyle:{position:"relative",top:"10px"},attrs:{readonly:"",label:"Effectivity Date",mask:"date",rules:["date"]},scopedSlots:e._u([{key:"append",fn:function(){return[o("q-icon",{staticClass:"cursor-pointer",attrs:{name:"event"}},[o("q-popup-proxy",{ref:"qDateProxy",attrs:{"transition-show":"scale","transition-hide":"scale"}},[o("q-date",{on:{input:function(){return e.$refs.qDateProxy.hide()}},model:{value:e.revision.effectivityDate,callback:function(t){e.$set(e.revision,"effectivityDate",t)},expression:"revision.effectivityDate"}})],1)],1)]},proxy:!0}]),model:{value:e.revision.effectivityDate,callback:function(t){e.$set(e.revision,"effectivityDate",t)},expression:"revision.effectivityDate"}})],1)])]),o("div",{staticClass:"col q-pt-md q-pb-md q-gutter-md"},[o("div",[e._v("Reason")]),o("q-editor",{attrs:{"min-height":"5rem",toolbar:[],fonts:e.fonts,readonly:""},model:{value:e.revision.reason,callback:function(t){e.$set(e.revision,"reason",t)},expression:"revision.reason"}}),o("div",[e._v("Details")]),o("q-editor",{attrs:{"min-height":"5rem",toolbar:[],fonts:e.fonts,readonly:""},model:{value:e.revision.details,callback:function(t){e.$set(e.revision,"details",t)},expression:"revision.details"}}),o("div",[e._v("Approvers")])],1),o("div",{staticClass:"row q-gutter-md"},e._l(e.node.versions[e.vi].approvers,function(t,i){return o("div",{key:"approvers"+i,staticStyle:{width:"320px"}},[o("div",{staticClass:"row q-pt-md"},[o("div",{staticClass:"col"},[o("div",[e._v(e._s(t.label))]),t.approved?o("q-chip",{attrs:{dense:""}},[o("q-avatar",{attrs:{icon:"thumb_up",color:"green","text-color":"white"}}),e._v("\n                "+e._s(e.$moment(t.timestamp).format("lll"))+"\n              ")],1):o("q-chip",{attrs:{dense:""}},[o("q-avatar",{attrs:{icon:"edit",color:"grey","text-color":"white"}}),e._v("\n                for signature\n              ")],1)],1),t.approved||t.value._id!==e.$root.user._id?e._e():o("q-btn",{staticClass:"item-end",attrs:{disabled:e.node.versions[e.vi].approvers[i-1]&&!e.node.versions[e.vi].approvers[i-1].approved},on:{click:function(){e.approve(i)}}},[e._v("\n              Approve\n            ")])],1)])}),0),o("q-card-actions",{staticClass:"text-primary",attrs:{align:"right"}},[o("q-btn",{attrs:{disabled:e.file.versions[e.vi].approved||e.file.versions[e.vi].initiator!==e.$root.user._id||!e.file.versions[e.vi]._id||e.node.versions[e.vi].initiator!==e.$root.user._id||e.node.versions[e.vi].approvers.filter(function(e){return e.approved}).length!==e.node.versions[e.vi].approvers.length,color:"primary",label:"Publish"},on:{click:e.publish}})],1)],1)],1)},P=[],z={props:["draftDialog","node","vi"],mounted:function(){this.refs=this.$refs,this.$nextTick(function(){})},data:function(){return{refs:{},file:this.node,draftUploader:{files:[]},jwt:window.localStorage.getItem("".concat(this.$dbCon.io.io.uri,"-jwt")),revision:{effectivityDate:this.node.versions[this.vi].effectivityDate,code:this.node.versions[this.vi].code,title:this.node.versions[this.vi].title,previousVersion:this.node.versions[this.vi].previousVersion,version:this.node.versions[this.vi].version,reason:this.node.versions[this.vi].reason,details:this.node.versions[this.vi].details,initiator:this.node.versions[this.vi].initiator,approved:this.node.versions[this.vi].approved},toolbar:[["left","center","right","justify"],["bold","italic","strike","underline","subscript","superscript"],["token","hr","link","custom_btn"],[{label:this.$q.lang.editor.formatting,icon:this.$q.iconSet.editor.formatting,list:"no-icons",options:["p","h1","h2","h3","h4","h5","h6","code"]},{label:this.$q.lang.editor.fontSize,icon:this.$q.iconSet.editor.fontSize,fixedLabel:!0,fixedIcon:!0,list:"no-icons",options:["size-1","size-2","size-3","size-4","size-5","size-6","size-7"]},{label:this.$q.lang.editor.defaultFont,icon:this.$q.iconSet.editor.font,fixedIcon:!0,list:"no-icons",options:["default_font","arial","arial_black","comic_sans","courier_new","impact","lucida_grande","times_new_roman","verdana"]},"removeFormat"],["quote","unordered","ordered","outdent","indent"],["undo","redo"],["print","fullscreen"]],fonts:{arial:"Arial",arial_black:"Arial Black",comic_sans:"Comic Sans MS",courier_new:"Courier New",impact:"Impact",lucida_grande:"Lucida Grande",times_new_roman:"Times New Roman",verdana:"Verdana"}}},methods:{close:function(){console.log("this.draftDialog",this.draftDialog),this.draftDialog[0].hide()},approve:function(){var e=l()(r.a.mark(function e(t){var o=this;return r.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:this.$q.dialog({title:"Approval Authentication",message:"Enter Password",prompt:{model:"",type:"password"},cancel:!0,persistent:!0}).onOk(function(){var e=l()(r.a.mark(function e(i){var s,n;return r.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return console.log(">>>> OK, received",i),e.prev=1,e.next=4,o.$axios.post(o.$dbCon.io.io.uri+"/authentication",{email:o.$root.user.email,password:i,strategy:"sso"});case 4:return o.$q.loading.show({message:"Publishing signed draft"}),s={},s["versions.".concat(o.vi,".approvers.").concat(t,".approved")]=!0,s["versions.".concat(o.vi,".approvers.").concat(t,".timestamp")]=Date.now(),e.next=10,o.$dbCon.services["juan-files"].patch(o.node._id,s);case 10:n="approvers",o.node.security[n].map(function(){var e=l()(r.a.mark(function e(t){var i;return r.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return i="",i=o.node.isFolder?o.$host+"/#/myDrive/"+o.node._id:o.$host+"/#/myDrive/"+o.node.parentFolder+"?f="+o.node._id,o.$axios.post("".concat(o.$dbCon.io.io.uri,"/sendMail"),{to:t.value.personal_information.email,subject:"OnlineISO: ".concat(o.node.label),message:"\n                ".concat(o.$root.user.personal_information.first_name," ").concat(o.$root.user.personal_information.surname,"\n                arpproved a change request (").concat(o.node.versions[o.vi].version,')\n                <a href="').concat(i,'">').concat(o.node.label,"</a> ").concat(o.node.isFolder?"folder":"file","\n              "),url:"".concat(i),html:{firstName:t.value.personal_information.first_name,message:"\n                  ".concat(o.$root.user.personal_information.first_name," ").concat(o.$root.user.personal_information.surname,"\n                  arpproved a change request (").concat(o.node.versions[o.vi].version,")\n                "),url:{text:'Open "'+o.node.label+'"',link:i}}},{"Content-Type":"application/json"}),e.next=5,o.$dbCon.services["juan-notifs"].create({from:o.$root.user,to:t.value,action:"Arpproved revision request (".concat(o.node.versions[o.vi].version,")"),access:n,data:o.node,timestamp:Date.now(),seen:!1});case 5:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),o.$dbCon.services["juan-notifs"].create({from:o.$root.user,to:o.node.logs[0].user,action:"Arpproved revision request (".concat(o.node.versions[o.vi].version,")"),access:n,data:o.node,timestamp:Date.now(),seen:!1}),o.$q.loading.hide(),e.next=21;break;case 16:e.prev=16,e.t0=e["catch"](1),console.log(e.t0),o.$q.notify({message:"Wrong Password",position:"bottom-right",color:"negative"}),o.$q.loading.hide();case 21:case"end":return e.stop()}},e,null,[[1,16]])}));return function(t){return e.apply(this,arguments)}}());case 1:case"end":return e.stop()}},e,this)}));function t(t){return e.apply(this,arguments)}return t}(),uploaded:function(){var e=l()(r.a.mark(function e(t){var o,i;return r.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return console.log("UPLOADED Trin"),e.prev=1,o=JSON.parse(t.xhr.response),o=Object.assign(o,this.revision),o.effectivityDate=new Date(this.revision.effectivityDate).getTime(),o.dateUploaded=(new Date).getTime(),o.approvers=this.$lodash.cloneDeep(this.node.security.approvers),i={},i["versions.".concat(this.vi,"._id")]=o._id,e.next=11,this.$dbCon.services["juan-files"].patch(this.node._id,i);case 11:this.file.versions[0]._id=o._id,this.$forceUpdate(),this.$refs.draftUploader.reset(),e.next=19;break;case 16:e.prev=16,e.t0=e["catch"](1),this.$q.notify({message:e.t0.toString(),position:"bottom-right",color:"negative"});case 19:this.$q.loading.hide();case 20:case"end":return e.stop()}},e,this,[[1,16]])}));function t(t){return e.apply(this,arguments)}return t}(),publish:function(){var e=l()(r.a.mark(function e(){var t,o,i,s,n,a=this;return r.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return t=this.$lodash.cloneDeep(this.node.logs),o={logs:t},o["versions.".concat(this.vi,".approved")]=!0,i={action:"New Version (".concat(this.node.versions[this.vi].version,")"),timestamp:Date.now(),data:this.node,user:this.$root.user},o.logs.push(i),e.next=7,this.$dbCon.services["juan-files"].patch(this.node._id,o);case 7:s=e.sent,this.$root.clickedItem=s,this.$q.notify({message:"Version ".concat(this.node.versions[this.vi].version," published"),position:"bottom-right",color:"positive"}),Object.keys(this.node.security).map(function(e){a.$lodash.isArray(a.node.security[e])&&a.node.security[e].map(function(){var t=l()(r.a.mark(function t(o){var i;return r.a.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return i="",i=a.node.isFolder?a.$host+"/#/myDrive/"+a.node._id:a.$host+"/#/myDrive/"+a.node.parentFolder+"?f="+a.node._id,a.$axios.post("".concat(a.$dbCon.io.io.uri,"/sendMail"),{to:o.value.personal_information.email,subject:"OnlineISO: ".concat(a.node.label),message:"\n                ".concat(a.$root.user.personal_information.first_name," ").concat(a.$root.user.personal_information.surname,"\n                published version (").concat(a.node.versions[a.vi].version,')\n                <a href="').concat(i,'">').concat(a.node.label,"</a> ").concat(a.node.isFolder?"folder":"file","\n              "),url:"".concat(i),html:{firstName:o.value.personal_information.first_name,message:"\n                  ".concat(a.$root.user.personal_information.first_name," ").concat(a.$root.user.personal_information.surname,"\n                  published version (").concat(a.node.versions[a.vi].version,")\n                "),url:{text:'Open "'+a.node.label+'"',link:i}}},{"Content-Type":"application/json"}),t.next=5,a.$dbCon.services["juan-notifs"].create({from:a.$root.user,to:o.value,action:"Published version ".concat(a.node.versions[a.vi].version," of"),access:e,data:a.node,timestamp:Date.now(),seen:!1});case 5:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}())}),n="",n=this.node.isFolder?this.$host+"/#/myDrive/"+this.node._id:this.$host+"/#/myDrive/"+this.node.parentFolder+"?f="+this.node._id,this.$axios.post("".concat(this.$dbCon.io.io.uri,"/sendMail"),{to:this.logs[0].user.personal_information.email,subject:"OnlineISO: ".concat(this.node.label),message:"\n          ".concat(this.$root.user.personal_information.first_name," ").concat(this.$root.user.personal_information.surname,"\n          published version (").concat(this.node.versions[this.vi].version,')\n          <a href="').concat(n,'">').concat(this.node.label,"</a> ").concat(this.node.isFolder?"folder":"file","\n        "),url:"".concat(n),html:{firstName:this.logs[0].user.personal_information.first_name,message:"\n            ".concat(this.$root.user.personal_information.first_name," ").concat(this.$root.user.personal_information.surname,"\n            published version (").concat(this.node.versions[this.vi].version,")\n          "),url:{text:'Open "'+this.node.label+'"',link:n}}},{"Content-Type":"application/json"}),this.$dbCon.services["juan-notifs"].create({from:this.$root.user,to:this.logs[0].user,action:"Published version ".concat(this.node.versions[this.vi].version," of"),access:"owner",data:this.node,timestamp:Date.now(),seen:!1});case 15:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}(),patch:function(){var e=l()(r.a.mark(function e(){var t,o,i,s=this,n=arguments;return r.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return t=n.length>0&&void 0!==n[0]?n[0]:{},o={},i={},Object.assign(i,t),Object.assign(i,this.revision),i.approvers=this.$lodash.cloneDeep(this.node.security.approvers),o["versions.".concat(this.vi,"._id")]=t.id,e.next=9,this.$dbCon.services["juan-files"].patch(this.node._id,o);case 9:this.node.security.approvers.map(function(){var e=l()(r.a.mark(function e(t){var o;return r.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return o="",o=s.node.isFolder?s.$host+"/#/myDrive/"+s.node._id:s.$host+"/#/myDrive/"+s.node.parentFolder+"?f="+s.node._id,s.$axios.post("".concat(s.$dbCon.io.io.uri,"/sendMail"),{to:t.value.personal_information.email,subject:"OnlineISO: ".concat(s.node.label),message:"\n            ".concat(s.$root.user.personal_information.first_name," ").concat(s.$root.user.personal_information.surname,"\n            published version (").concat(s.node.versions[s.vi].version,')\n            <a href="').concat(o,'">').concat(s.node.label,"</a> ").concat(s.node.isFolder?"folder":"file","\n          "),url:"".concat(o),html:{firstName:t.value.personal_information.first_name,message:"\n              ".concat(s.$root.user.personal_information.first_name," ").concat(s.$root.user.personal_information.surname,"\n              published version (").concat(s.node.versions[s.vi].version,")\n            "),url:{text:'Open "'+s.node.label+'"',link:o}}},{"Content-Type":"application/json"}),e.next=5,s.$dbCon.services["juan-notifs"].create({from:s.$root.user,to:t.value,action:"edited a draft",access:"revision",data:s.node,timestamp:Date.now(),seen:!1});case 5:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()),this.draftDialog[0].hide(),this.$q.notify({message:"Draft was edited",position:"bottom-right",color:"positive"}),this.$q.loading.hide();case 13:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}(),currentVersion:function(e){var t=null;return t="undefined"===typeof e.versions[0].approved?0:e.versions[0].approved?0:1,e.versions[t]},open:function(e){window.open("".concat(this.$dbCon.io.io.uri,"/uploads?_id=").concat(e),"_blank")}}},M=z,V=Object(h["a"])(M,j,P,!1,null,null,null),U=V.exports,R={props:["node"],components:{uploadDraft:k,editDraft:F,viewDraft:U},data:function(){return{draftDialogIsOpen:!1,editDraftDialogIsOpen:!1,viewDraftDialogIsOpen:!1,draftDialog:null,editDraftDialog:null,viewDraftDialog:null}},methods:{openViewDraftDialog:function(){this.viewDraftDialog=this.$refs.viewDraftDialog,this.viewDraftDialogIsOpen=!0},openEditDraftDialog:function(){this.editDraftDialog=this.$refs.editDraftDialog,this.editDraftDialogIsOpen=!0},openDraftDialog:function(){this.draftDialog=this.$refs.draftDialog,this.draftDialogIsOpen=!0},open:function(e){window.open("".concat(this.$dbCon.io.io.uri,"/uploads?_id=").concat(e),"_blank")}}},T=R,A=Object(h["a"])(T,_,w,!1,null,null,null),E=A.exports,Y=o("4912"),L=o("c93d"),B=o("2bdc"),G=o("3da2"),J=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("q-layout",{staticClass:"bg-white text-black",staticStyle:{"min-width":"80vw"},attrs:{container:""}},[o("q-header",{staticClass:"bg-white text-black shadow-up-1"},[o("q-toolbar",{},[o("q-btn",{attrs:{flat:"",round:"",dense:"",icon:"fas fa-signature",color:"purple"}}),o("q-toolbar-title",[e._v("For Signature")]),o("q-toolbar-title",[o("i",{staticClass:"text-body1"},[e._v(e._s(e.node.label))])]),o("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",round:"",dense:"",icon:"close"}})],1)],1),o("q-page-container",{ref:"printable",staticClass:"q-pa-lg col"},[o("div",{staticClass:"q-pt-lg col"},[e.responsesSrvc&&"list"===e.tab?o("q-table",{attrs:{data:e.responses,columns:e.columns,"row-key":"_id",pagination:e.pagination,loading:e.loading,"binary-state-sort":""},on:{"update:pagination":[function(t){e.pagination=t},e.customSort]},scopedSlots:e._u([{key:"body",fn:function(t){return[o("tr",{on:{mouseover:function(o){e.hover=t.row._id}}},[e._l(e.node.format,function(i){return o("td",{key:i.field,staticClass:"text-right",attrs:{props:t}},[t.row[i.field]?o("div",["Text"===i.type||"Text"===i.type.value?o("span",[e._v("\n                  "+e._s(t.row[i.field])+"\n                ")]):"Select"===i.type.value?o("div",[i.isMultiple?e._l(t.row[i.field],function(e,i){return o("q-chip",{key:t.row._id+i,staticClass:"text-white",attrs:{label:e.value,dense:"",color:"purple"}})}):o("span",[e._v(" "+e._s(t.row[i.field].value)+" ")])],2):"Date"===i.type.value?o("span",[e._v("\n                  "+e._s(e.$moment(t.row[i.field]).format("YYYY-MM-DD"))+"\n                ")]):"digiSign"===i.type.value?o("span",[e._v("\n                  "+e._s(t.row[i.field].displayName)+" "),o("br"),e._v("\n                  "+e._s(t.row[i.field].datetime?e.$moment(t.row[i.field].datetime).format("YYYY-MM-DD"):t.row[i.field].assignedTo.label)+"\n                ")]):o("div",[e._v("\n                  "+e._s(t.row[i.field])+"\n                ")])]):e._e()])}),o("td",[t.row._id===e.hover?o("div",{staticClass:"q-gutter-sm"},[o("q-btn",{attrs:{icon:"remove_red_eye",color:"purple",size:"sm",round:""},on:{click:function(o){return e.openResponse(t.row)}}})],1):e._e()])],2)]}},{key:"top-right",fn:function(){return[o("q-input",{attrs:{borderless:"",dense:"",debounce:"750",placeholder:"Search"},on:{input:function(t){return e.customSort(e.pagination)}},scopedSlots:e._u([{key:"append",fn:function(){return[o("q-icon",{attrs:{name:"search"}})]},proxy:!0}],null,!1,4009527860),model:{value:e.filter,callback:function(t){e.filter=t},expression:"filter"}})]},proxy:!0},{key:"bottom",fn:function(){return[o("div",{staticClass:"col"},[e._v("\n            Total records: "+e._s(e.responsesSrvc.total)+"\n          ")]),o("div",{staticClass:"row q-gutter-sm items-center"},[o("q-btn",{attrs:{disabled:1===e.responsesSrvc.page,round:"",icon:"chevron_left",flat:"",size:"sm"},on:{click:function(t){return e.responsesSrvc.loadPage(e.responsesSrvc.page-1)}}}),o("div",[e._v("\n              page "+e._s(e.responsesSrvc.page)+" of "+e._s(e.$lodash.ceil(e.responsesSrvc.total/e.responsesSrvc.limit))+"\n            ")]),o("q-btn",{attrs:{disabled:e.responsesSrvc.page===e.$lodash.ceil(e.responsesSrvc.total/e.responsesSrvc.limit),round:"",icon:"chevron_right",flat:"",size:"sm"},on:{click:function(t){return e.responsesSrvc.loadPage(e.responsesSrvc.page+1)}}})],1)]},proxy:!0}],null,!1,205653633)}):e.responsesSrvc&&"stat"===e.tab?o("stat",{attrs:{node:e.node}}):e._e()],1)]),o("q-footer",[o("q-toolbar",{staticClass:"bg-white text-black shadow-1"},[o("q-btn",{attrs:{size:"md",flat:"",color:"purple",label:"download",icon:"fas fa-file-csv"},on:{click:e.exportCSV}}),o("q-toolbar-title"),this.$root.user._id===e.node.owner?o("q-btn-toggle",{staticClass:"bg-grey-3",attrs:{rounded:"",unelevated:"","toggle-color":"purple","text-color":"purple",options:[{label:"List",value:"list",icon:"list"},{label:"Stat",value:"stat",icon:"insert_chart_outlined"}]},model:{value:e.tab,callback:function(t){e.tab=t},expression:"tab"}}):e._e()],1)],1),o("q-dialog",{attrs:{if:"viewFormIsOpen",persistent:""},model:{value:e.viewFormIsOpen,callback:function(t){e.viewFormIsOpen=t},expression:"viewFormIsOpen"}},[o("view-form",{attrs:{node:e.node,response:e.response}})],1)],1)},W=[],K=o("7e0a"),H={props:["refs","node","userID"],components:{viewForm:L["a"],stat:K["a"]},beforeDestroy:function(){this.responsesSrvc.destroy()},mounted:function(){var e=this;this.loading=!0,this.responsesSrvc=this.$dbCon.wingsService("juan-responses").on("dataChange",function(t){e.responses=t,console.log(t,e.responsesSrvc.total),e.loading=!1}),this.customSort({pagination:this.pagination})},computed:{columns:function(){var e=this.node.format.map(function(e){return{name:e.field,label:e.field,field:e.field,sortable:!0}});return Array.prototype.push.apply(e,[{name:"form-action",label:"",field:"form-action"}]),e}},data:function(){return{tab:"list",viewFormIsOpen:!1,response:{},hover:null,responsesSrvc:null,responses:[],loading:!1,filter:"",page:1,pagination:{sortBy:this.node.format[0].field,descending:!1,page:1,rowsPerPage:10}}},methods:{customSort:function(e){var t=this;console.log("triggered",e);var o=e.sortBy,i=e.descending;this.loading=!0;var s={paginate:!0,channels:[]},n={query:{formID:this.node._id}};if(this.filter&&(n.query.$search=this.filter),this.userID&&(n.query.$or=[],console.log("format",this.node.format),this.node.format.map(function(e){if(e.type.value&&"digiSign"===e.type.value){console.log(e.type.value);var o={};o["".concat(e.field,".assignedTo.value._id")]=t.userID,o["".concat(e.field,".userId")]={$ne:t.userID},n.query.$or.push(o),s.channels.push({prop:"".concat(e.field),value:function(e,o){return e.assignedTo.value===t.userID&&e.userId!==t.userID}})}})),o){var r={};r[o]=i?-1:1,n.query.$sort=r}this.query={params:n,config:s},this.responsesSrvc.reset(n,s),console.log("sortBy",n)},exportCSV:function(){var e=l()(r.a.mark(function e(){var t,o,i,s=this;return r.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return t=[],this.query.params.query.$limit=500,e.next=4,this.responsesSrvc.find(this.query.params);case 4:o=e.sent,i=o.data,i.map(function(e){var o={};s.node.format.map(function(t){"Select"===t.type.value?o[t.field]=t.isMultiple?e[t.field].map(function(e){return e.value}).join(", "):e[t.field].value:"digiSign"===t.type.value?(o["".concat(t.field," - Signer")]=e[t.field].displayName,o["".concat(t.field," - date")]=s.$moment(e[t.field].datetime).format("YYYY-MM-DD")):"Date"===t.type.value?o[t.field]=s.$moment(e[t.field]).format("YYYY-MM-DD"):o[t.field]=e[t.field]}),t.push(o)}),this.$arrayToCSV(t,this.node.label+" - "+Date.now()+".csv");case 8:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}(),openResponse:function(e){this.response=e,this.viewFormIsOpen=!0},removeResponse:function(e){var t=this;this.$q.dialog({title:"Approval Authentication",html:!0,message:"Are you sure you want to delete <b>"+e._id+"</b>? <br> Enter Password",prompt:{model:"",type:"password"},cancel:!0,persistent:!0}).onOk(function(){var o=l()(r.a.mark(function o(i){return r.a.wrap(function(o){while(1)switch(o.prev=o.next){case 0:return console.log(">>>> OK, received",i),o.prev=1,o.next=4,t.$axios.post(t.$dbCon.io.io.uri+"/authentication",{email:t.$root.user.email,password:i,strategy:"sso"});case 4:t.responsesSrvc.remove(e._id),o.next=10;break;case 7:o.prev=7,o.t0=o["catch"](1),t.$q.notify({message:"Wrong Password",position:"bottom",color:"negative"});case 10:case"end":return o.stop()}},o,null,[[1,7]])}));return function(e){return o.apply(this,arguments)}}())}}},Q=H,X=Object(h["a"])(Q,J,W,!1,null,"1aa80835",null),Z=X.exports,ee=o("ed50"),te=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("q-card",{staticStyle:{"min-width":"400px"}},[o("q-card-section",{staticClass:"row"},[o("div",{staticClass:"text-h6 col"},[e._v("Manage Version")]),o("div")]),o("q-card-section",{staticClass:"col"},[o("q-list",{staticClass:"q-pt-sm q-pb-sm",staticStyle:{"min-width":"200px"},attrs:{dense:""}},[e.node.draft?o("q-item",{directives:[{name:"ripple",rawName:"v-ripple"}],attrs:{clickable:""}},[o("q-item-section",{attrs:{avatar:""}},[o("q-icon",{attrs:{color:"blue-grey",name:"history"}})],1),o("q-item-section",[o("q-item-label",{attrs:{lines:"1"}},[e._v(e._s(e.node.draft.version))]),o("q-item-label",{attrs:{caption:""}},[e._v(e._s(e.$moment(e.node.draft.dateUploaded).format("lll")))])],1),o("q-item-section",{attrs:{side:""}},[o("q-chip",{attrs:{color:"deep-orange","text-color":"white",icon:"thumbs_up_down"}},[e._v("\n            Change Request\n          ")])],1),e.$lodash.findIndex(e.node.security.approvers,function(t){return t.value._id===e.$root.user._id})>-1||e.node.owner===e.$root.user._id?o("q-item-section",{attrs:{side:""}},[o("doc-diff",{ref:"docDiff",attrs:{node:e.node,update:e.node.draft,old:{content:e.node.content,label:e.node.label,version:e.node.version}}}),o("q-btn",{attrs:{icon:"fas fa-signature",round:"",size:"sm"},on:{click:function(t){return e.$refs.docDiff.show()}}})],1):e._e()],1):e._e(),e.node.versions?o("span",e._l(e.versions,function(t,i){return o("q-item",{directives:[{name:"ripple",rawName:"v-ripple"}],key:"ver"+i,attrs:{clickable:""}},[o("q-item-section",{attrs:{avatar:""}},[o("q-icon",{attrs:{color:"blue-grey",name:"history"}})],1),o("q-item-section",[o("q-item-label",{attrs:{lines:"1"}},[e._v(e._s(t.version))]),o("q-item-label",{attrs:{caption:""}},[e._v(e._s(e.$moment(t.dateUploaded).format("lll")))])],1),i+1!==e.node.versions.length?o("q-item-section",{attrs:{side:""}},[o("doc-diff",{ref:"docDiff"+i,refInFor:!0,attrs:{update:t,old:e.versions[i+1]}}),o("q-btn",{attrs:{icon:"search",round:"",size:"sm"},on:{click:function(t){e.$refs["docDiff"+i][0].show()}}})],1):e._e(),!["doc"].includes(e.node.type)&&i!==e.node.versions.length-1&&(e.$lodash.findIndex(e.node.security.approvers,function(t){return t.value._id===e.$root.user._id})>-1||e.node.logs[0].user._id===e.$root.user._id)?o("q-item-section",{attrs:{side:""}},[o("q-dialog",{ref:"viewDraftDialog",refInFor:!0,attrs:{persistent:""},model:{value:e.viewDraftDialogIsOpen,callback:function(t){e.viewDraftDialogIsOpen=t},expression:"viewDraftDialogIsOpen"}},[o("view-draft",{attrs:{draftDialog:e.viewDraftDialog,node:e.node,vi:i}})],1),o("q-btn",{attrs:{icon:"search",round:"",size:"sm"},on:{click:e.openViewDraftDialog}})],1):e._e(),["doc"].includes(e.node.type)||!t.approved&&0===i?e._e():o("q-item-section",{attrs:{side:""}},[o("q-btn",{attrs:{icon:"cloud_download",round:"",size:"sm"},on:{click:function(o){return e.open(t._id)}}})],1)],1)}),1):e._e()],1)],1)],1)},oe=[],ie=o("dd06"),se={props:["node"],components:{docDiff:ie["a"],viewDraft:U},data:function(){return{draftDialogIsOpen:!1,editDraftDialogIsOpen:!1,viewDraftDialogIsOpen:!1,draftDialog:null,editDraftDialog:null,viewDraftDialog:null}},computed:{versions:function(){return this.node.versions.slice().reverse()}},methods:{openViewDraftDialog:function(){this.viewDraftDialog=this.$refs.viewDraftDialog,this.viewDraftDialogIsOpen=!0},openEditDraftDialog:function(){this.editDraftDialog=this.$refs.editDraftDialog,this.editDraftDialogIsOpen=!0},openDraftDialog:function(){this.draftDialog=this.$refs.draftDialog,this.draftDialogIsOpen=!0},open:function(e){window.open("".concat(this.$dbCon.io.io.uri,"/uploads?_id=").concat(e),"_blank")}}},ne=se,re=Object(h["a"])(ne,te,oe,!1,null,null,null),ae=re.exports,le={components:{docVersions:ae,newDoc:ee["a"],forSignature:Z,moveTo:b,versionsDialog:E,approveDialog:Y["a"],viewForm:L["a"],juanForm:B["a"],juanResponses:G["a"]},mounted:function(){this.security=d()({},this.security,Object(u["cloneDeep"])(this.node.security)),this.tempNode=this.$lodash.cloneDeep(this.node)},props:["node"],data:function(){return{modifying:!1,form:{},newDocPrompt:!1,signaturePrompt:!1,responsesPrompt:!1,formPrompt:!1,viewFormIsOpen:!1,versionsDialogIsOpen:!1,renameFolderPrompt:!1,tempNode:{label:""},shareDialogIsOpen:!1,searchedUsers:[],security:{public:!1,viewers:[],uploaders:[],modifiers:[],removers:[],folderCreators:[],approvers:[]}}},methods:{open:function(e){e.type&&"doc"===e.type?this.newDocPrompt=!0:e.type&&"form"===e.type?this.viewFormIsOpen=!0:e.isFolder?this.$router.push("/myDrive/"+e._id):(1===e.versions.length||e.versions[0].approved,window.open("".concat(this.$dbCon.io.io.uri,"/uploads?_id=").concat(e._id).concat(!0!==e.security.public?"&t="+this.$root.jwt:""),"_blank")),this.modifying=!1},modify:function(e){e.type&&"doc"===e.type?this.newDocPrompt=!0:e.type&&"form"===e.type&&(this.form=this.$lodash.cloneDeep(this.node),this.formPrompt=!0),this.modifying=!0},showResponses:function(e){this.responsesPrompt=!0},showForSignature:function(){this.signaturePrompt=!0},showRenameModal:function(){this.renameFolderPrompt=!0,this.tempNode=this.$lodash.cloneDeep(this.node)},saveFolder:function(){var e=l()(r.a.mark(function e(){var t,o;return r.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return this.tempNode.security=this.security,t=Date.now(),o={action:"renamed",timestamp:t,data:{new:this.$deepDiff(this.tempNode,this.node),old:this.$deepDiff(this.node,this.tempNode)},user:this.$root.user},e.next=5,this.$dbCon.services[this.node.isFolder?"juan-folders":"juan-files"].patch(this.node._id,{label:this.tempNode.label,logs:this.tempNode.logs.concat([o])});case 5:this.renameFolderPrompt=!1;case 6:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}(),searchUsers:function(){var e=l()(r.a.mark(function e(t,o,i){var s,n=this;return r.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(!(t.length<2)){e.next=3;break}return i(),e.abrupt("return");case 3:return e.next=5,this.$sso.services.users.find({query:{$search:t}});case 5:s=e.sent,console.log(s.data),o(function(){n.searchedUsers=s.data.map(function(e){return delete e.training_programs,delete e.voluntary_work,delete e.work_experience,delete e.civil_service_eligibility,delete e.educational_background,delete e.family_background,delete e.other_information,delete e.extra_information.signature,{label:e.personal_information.first_name+" "+e.personal_information.surname,value:e}})});case 8:case"end":return e.stop()}},e,this)}));function t(t,o,i){return e.apply(this,arguments)}return t}(),saveSecurity:function(){var e=l()(r.a.mark(function e(){var t,o,i,s=this;return r.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return t=this.$deepDiff(this.security,this.node.security),this.tempNode.security=this.security,o=Date.now(),i={action:"Shared",timestamp:o,data:{new:this.$deepDiff(this.tempNode,this.node),old:this.$deepDiff(this.node,this.tempNode)},user:this.$root.user},e.next=6,this.$dbCon.services[this.node.isFolder?"juan-folders":"juan-files"].patch(this.node._id,{security:this.security,logs:this.tempNode.logs.concat([i])});case 6:this.shareDialogIsOpen=!1,Object(u["isEmpty"])(t)||(console.log("Security has Update"),Object.keys(t).map(function(e){console.log(e,t[e]),s.$lodash.isArray(t[e])&&t[e].map(function(){var t=l()(r.a.mark(function t(o){var i;return r.a.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return i="",i=s.node.isFolder?s.$host+"/#/myDrive/"+s.node._id:s.$host+"/#/myDrive/"+s.node.parentFolder+"?f="+s.node._id,s.$axios.post("".concat(s.$dbCon.io.io.uri,"/sendMail"),{to:o.value.personal_information.email,subject:"OnlineISO: ".concat(s.node.label),message:"\n                  ".concat(s.$root.user.personal_information.first_name," ").concat(s.$root.user.personal_information.surname,'\n                  shared\n                  <a href="').concat(i,'">').concat(s.node.label,"</a> ").concat(s.node.isFolder?"folder":"file","\n                "),url:"".concat(i),html:{firstName:o.value.personal_information.first_name,message:"\n                    ".concat(s.$root.user.personal_information.first_name," ").concat(s.$root.user.personal_information.surname,"\n                    shared a ").concat(s.node.isFolder?"folder":"file","\n                  "),url:{text:'Open "'+s.node.label+'"',link:i}}},{"Content-Type":"application/json"}),t.next=5,s.$dbCon.services["juan-notifs"].create({from:s.$root.user,to:o.value,action:"shared",access:e,data:s.node,timestamp:Date.now(),seen:!1});case 5:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}())}));case 8:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}(),remove:function(){var e=this;this.$root.clickedItem=this.$root.nodeFormat,this.$q.dialog({title:"Confirm",message:"Would you like to delete this ".concat(this.node.label),ok:{color:"negative"},cancel:{},persistent:!0}).onOk(l()(r.a.mark(function t(){var o,i;return r.a.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return e.$root.clickedItem=e.$root.nodeFormat,e.tempNode.security=e.security,o=Date.now(),i={action:"Trashed",timestamp:o,user:e.$root.user},t.next=6,e.$dbCon.services[e.node.isFolder?"juan-folders":"juan-files"].patch(e.node._id,{trash:!0,logs:e.tempNode.logs.concat([i])});case 6:e.$q.notify({message:e.node.label+" was removed",position:"bottom-left",actions:[{label:"Undo",handler:function(){var t=l()(r.a.mark(function t(){var o,i;return r.a.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return o=Date.now(),i={action:"Recovered",timestamp:o,user:e.$root.user},t.next=4,e.$dbCon.services[e.node.isFolder?"juan-folders":"juan-files"].patch(e.node._id,{trash:!1,logs:e.tempNode.logs.concat([i])});case 4:e.$q.notify({message:e.node.label+" was restored",position:"bottom-left"});case 5:case"end":return t.stop()}},t)}));function o(){return t.apply(this,arguments)}return o}()}]});case 7:case"end":return t.stop()}},t)})))}}},ce=le,de=Object(h["a"])(ce,i,s,!1,null,null,null);t["a"]=de.exports},"46d1":function(e,t,o){"use strict";var i=o("3e59"),s=o.n(i);s.a}}]);