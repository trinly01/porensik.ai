(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["e4e3e832"],{"194b":function(e,t,r){"use strict";r.r(t);var o=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("q-page",{ref:"container",staticClass:"q-pa-md ",attrs:{id:"t-main-body"},on:{drop:function(e){e.preventDefault()},dragover:function(t){return t.preventDefault(),e.openNewMenuUpload(t)}},nativeOn:{click:function(t){e.$root.clickedItem=e.$root.currentFolder}}},[e.$root.user&&("My Drive"===this.$root.currentFolder._id||this.$root.currentFolder.owner===e.$root.user._id||e.$lodash.findIndex(this.$root.currentFolder.security.uploaders,function(t){return t.value._id===e.$root.user._id})>-1)?r("new-menu",{ref:"nMenu"}):e._e(),r("div",{staticClass:"text-caption q-pb-md"},[e._v("Folders")]),r("div",{staticClass:"row items-start q-gutter-md q-pb-md q-pr-md"},e._l(e.folders,function(t){return r("q-card",{key:t._id,staticClass:"my-card col-xs-12 col-sm-6 col-md-4 col-lg-3 col-xl-2 no-shadow",style:{"background-color":e.$root.clickedItem._id===t._id?"#E1F5FE":"white"},attrs:{bordered:"",id:t._id},nativeOn:{dblclick:function(r){return e.dblclick(t)},click:function(r){e.$timeout(function(){e.$root.clickedItem=t},10)}}},[r("q-card-section",{staticClass:"row items-center no-wrap",staticStyle:{"max-height":"56px"}},[r("div",{staticClass:"col text-weight-regular limited-text",class:{"text-primary":e.$root.clickedItem._id===t._id,"text-blue-grey-14":e.$root.clickedItem._id!==t._id}},[r("q-btn",{staticClass:"bg-white q-mr-sm",attrs:{round:"",flat:"",color:"blue-grey",size:"sm",icon:"folder"}}),r("span",[e._v("\n              "+e._s(t.label)+"\n              "),t.label.length>25?r("q-tooltip",[e._v("\n                "+e._s(t.label)+"\n              ")]):e._e()],1)],1),r("div",{staticClass:"col-auto"},[r("q-btn",{attrs:{color:"grey-7",size:"sm",round:"",flat:"",icon:"more_vert"}},[r("node-menu",{attrs:{node:t}})],1)],1)])],1)}),1),r("div",{staticClass:"row text-caption q-mt-md"},[e._v("Files")]),r("div",{staticClass:"row items-start q-gutter-md q-pb-md q-pr-md"},e._l(e.files,function(t){return r("q-card",{directives:[{name:"show",rawName:"v-show",value:!t.trash&&t.parentFolder===e.$route.params._id,expression:"!file.trash && file.parentFolder === $route.params._id"}],key:t._id,staticClass:"my-card col-xs-12 col-sm-6 col-md-4 col-lg-3 col-xl-2 no-shadow",style:{"background-color":e.$root.clickedItem._id===t._id?"#E1F5FE":"white"},attrs:{bordered:"",id:t._id},on:{dblclick:function(r){e.$refs["node-menu-"+t._id][0].open(t)}},nativeOn:{click:function(r){e.$timeout(function(){e.$root.clickedItem=t},10)}}},[t.versions&&e.$lodash.isImage(e.currentVersion(t).fileName)?r("div",{staticClass:"thumbnail row justify-center bg-blue-grey-1"},[r("img",{key:t._id,staticClass:"portrait",attrs:{src:e.$dbCon.io.io.uri+"/uploads?_id="+t._id+(!0!==t.security.public?"&t="+e.$root.jwt:""),alt:"Image"}})]):t.versions&&e.$lodash.isVideo(e.currentVersion(t).fileName)?r("div",{staticClass:"thumbnail"},[r("video",{staticClass:"thumbnail",attrs:{controls:"",preload:"none"}},[r("source",{attrs:{src:e.$dbCon.io.io.uri+"/uploads?_id="+t._id+(!0!==t.security.public?"&t="+e.$root.jwt:"")}}),e._v("\n          Your browser does not support the "),r("code",[e._v("video")]),e._v(" tag.\n        ")])]):t.versions&&e.$lodash.isAudio(e.currentVersion(t).fileName)?r("div",{staticClass:"thumbnail bg-blue-grey-1"},[r("audio",{staticClass:"q-pa-md",staticStyle:{position:"absolute",width:"100%",top:"32px"},attrs:{controls:"",preload:"none"}},[r("source",{attrs:{src:e.$dbCon.io.io.uri+"/uploads?_id="+e.currentVersion(t)._id}}),e._v("\n          Your browser does not support the "),r("code",[e._v("audio")]),e._v(" tag.\n        ")])]):r("div",{staticClass:"row justify-center bg-blue-grey-1"},[t.type&&"doc"===t.type?r("q-icon",{staticClass:"q-pt-md q-pb-md thumbnail",attrs:{name:"fas fa-file-alt",size:"64px",color:"blue-grey-3"}}):t.type&&"form"===t.type?r("q-icon",{staticClass:"q-pt-md q-pb-md thumbnail",attrs:{name:"fas fa-file-signature",size:"64px",color:"blue-grey-3"}}):r("q-icon",{staticClass:"q-pt-md q-pb-md thumbnail",attrs:{name:"fas fa-file",size:"64px",color:"blue-grey-3"}})],1),r("q-card-section",{staticClass:"row items-center no-wrap",staticStyle:{"max-height":"56px"}},[r("div",{staticClass:"col text-weight-regular limited-text",class:{"text-primary":e.$root.clickedItem._id===t._id,"text-blue-grey-14":e.$root.clickedItem._id!==t._id}},[t.type&&"doc"===t.type?r("q-btn",{staticClass:"bg-white q-mr-sm",attrs:{icon:"fas fa-file-alt",round:"",flat:"",color:"blue",size:"sm"}}):t.type&&"form"===t.type?r("q-btn",{staticClass:"bg-white q-mr-sm",attrs:{icon:"fas fa-file-signature",round:"",flat:"",color:"purple",size:"sm"}}):t.versions&&e.$lodash.isImage(e.currentVersion(t).fileName)?r("q-btn",{staticClass:"bg-white q-mr-sm",attrs:{icon:"photo_size_select_actual",round:"",flat:"",color:"red",size:"sm"}}):t.versions&&e.$lodash.isVideo(e.currentVersion(t).fileName)?r("q-btn",{staticClass:"bg-white q-mr-sm",attrs:{icon:"videocam",round:"",flat:"",color:"red",size:"sm"}}):t.versions&&e.$lodash.isAudio(e.currentVersion(t).fileName)?r("q-btn",{staticClass:"bg-white q-mr-sm",attrs:{icon:"volume_up",round:"",flat:"",color:"red",size:"sm"}}):r("q-btn",{staticClass:"bg-white q-mr-sm",attrs:{icon:"fas fa-file",round:"",flat:"",color:"blue",size:"sm"}}),r("span",[e._v("\n            "+e._s(t.label)+"\n            "),t.label.length>25?r("q-tooltip",[e._v("\n              "+e._s(t.label)+"\n            ")]):e._e()],1)],1),r("div",{staticClass:"col-auto"},[r("q-btn",{attrs:{color:"grey-7",size:"sm",round:"",flat:"",icon:"more_vert"}},[r("node-menu",{ref:"node-menu-"+t._id,refInFor:!0,attrs:{node:t}})],1)],1)])],1)}),1)],1)},i=[],s=r("02fa"),n=r.n(s),a=(r("20d6"),r("967e")),l=r.n(a),c=(r("96cf"),r("fa84")),d=r.n(c),u=r("68ff"),p=r("444c"),m={name:"PageIndex",components:{newMenu:u["a"],nodeMenu:p["a"]},data:function(){return{foldersSrvc:null,filesSrvc:null,onAuth:null,folders:[],files:[]}},watch:{$route:function(){var e=d()(l.a.mark(function e(t,r){return l.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:this.getFoldersAndFiles();case 1:case"end":return e.stop()}},e,this)}));function t(t,r){return e.apply(this,arguments)}return t}()},beforeDestroy:function(){this.foldersSrvc.destroy(),this.filesSrvc.destroy(),this.$dbCon.removeListener("authenticated",this.onAuth)},mounted:function(){var e=this;this.foldersSrvc=this.$dbCon.wingsService("juan-folders").on("dataChange",function(t){e.folders=t,console.log("folders",t)}),this.filesSrvc=this.$dbCon.wingsService("juan-files").on("dataChange",function(t){if(e.files=t,e.$route.query.f){var r=e.$lodash.findIndex(e.files,{_id:e.$route.query.f});r>-1&&(e.$root.clickedItem=e.files[r],document.getElementById(e.files[r]._id).scrollIntoView({block:"center",behavior:"smooth"}))}}),this.onAuth=function(){var t=d()(l.a.mark(function t(r){return l.a.wrap(function(t){while(1)switch(t.prev=t.next){case 0:delete r.user.training_programs,delete r.user.voluntary_work,delete r.user.work_experience,delete r.user.civil_service_eligibility,delete r.user.educational_background,delete r.user.family_background,delete r.user.other_information,delete r.user.extra_information.signature,e.$root.user=r.user,console.log("AUTH OY!"),e.getFoldersAndFiles();case 11:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}(),this.$root.user&&this.getFoldersAndFiles(),this.$dbCon.on("authenticated",this.onAuth)},methods:{openNewMenuUpload:function(){var e=d()(l.a.mark(function e(t){return l.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:this.$refs.nMenu.newFile();case 1:case"end":return e.stop()}},e,this)}));function t(t){return e.apply(this,arguments)}return t}(),currentVersion:function(e){var t=null;return t="undefined"===typeof e.versions[0].approved?0:e.versions[0].approved?0:1,e.versions[t].fileName=e.versions[t].fileName||"",e.versions[t]},dblclick:function(){var e=d()(l.a.mark(function e(t){return l.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:this.$router.push("/myDrive/"+t._id),this.$root.currentFolder=t,this.$root.clickedItem=t;case 3:case"end":return e.stop()}},e,this)}));function t(t){return e.apply(this,arguments)}return t}(),checkSecurity:function(e){var t=this;return e.public||this.$lodash.findIndex(e.viewers,function(e){return e.value._id===t.$root.user._id})>-1||this.$lodash.findIndex(e.uploaders,function(e){return e.value._id===t.$root.user._id})>-1||this.$lodash.findIndex(e.modifiers,function(e){return e.value._id===t.$root.user._id})>-1||this.$lodash.findIndex(e.removers,function(e){return e.value._id===t.$root.user._id})>-1||this.$lodash.findIndex(e.folderCreators,function(e){return e.value._id===t.$root.user._id})>-1||this.$lodash.findIndex(e.approvers,function(e){return e.value._id===t.$root.user._id})>-1},getParamsConfig:function(){var e=this,t={$sort:{"logs.timestamp":-1},trash:{$ne:!0}},r=[{"security.public":!0},{"security.public":{$ne:!1}},{owner:this.$root.user._id},{"security.viewers":{$elemMatch:{"value._id":this.$root.user._id}}},{"security.uploaders":{$elemMatch:{"value._id":this.$root.user._id}}},{"security.modifiers":{$elemMatch:{"value._id":this.$root.user._id}}},{"security.removers":{$elemMatch:{"value._id":this.$root.user._id}}},{"security.folderCreators":{$elemMatch:{"value._id":this.$root.user._id}}},{"security.approvers":{$elemMatch:{"value._id":this.$root.user._id}}}],o=[{value:function(t,r){var o=r.owner===e.$root.user._id&&t===e.$route.params._id&&!r.trash;return console.log("con 1",o),o},prop:"parentFolder"},{value:function(t,r){var o=e.checkSecurity(t)&&r.parentFolder===e.$route.params._id&&!r.trash;return console.log("con 2",o),o},prop:"security"}],i={query:n()({$limit:500,parentFolder:this.$route.params._id},t,{$or:r})},s={debug:!0,channels:o,newDataPosition:"start"};return{params:i,config:s}},getPath:function(){var e=d()(l.a.mark(function e(t){var r;return l.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return this.$root.path.unshift({label:t.label,_id:t._id}),console.log("this.$root.path",this.$root.path),e.prev=2,e.next=5,this.$dbCon.service("juan-folders").get(t.parentFolder);case 5:return r=e.sent,e.next=8,this.getPath(r);case 8:e.next=13;break;case 10:e.prev=10,e.t0=e["catch"](2),"My Drive"!==t._id&&this.$root.path.unshift({label:"My Drive",_id:"My Drive"});case 13:case"end":return e.stop()}},e,this,[[2,10]])}));function t(t){return e.apply(this,arguments)}return t}(),rePath:function(){var e=d()(l.a.mark(function e(){var t;return l.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(this.$root.path=[],t=this.$route.params._id,"My Drive"!==t){e.next=8;break}this.$root.currentFolder=this.$root.nodeFormat,this.$root.clickedItem=this.$root.nodeFormat,this.$root.path=[{label:"My Drive",_id:"My Drive"}],e.next=14;break;case 8:return e.next=10,this.$dbCon.services["juan-folders"].get(t);case 10:return this.$root.currentFolder=e.sent,e.next=13,this.getPath(this.$root.currentFolder);case 13:this.checkSecurity(this.$root.currentFolder.security)||this.$root.currentFolder.owner===this.$root.user._id||this.$router.push("/unauthorized");case 14:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}(),getFoldersAndFiles:function(){var e=d()(l.a.mark(function e(){var t,r,o;return l.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return console.log("getFoldersAndFiles"),t=this.getParamsConfig(),r=t.params,o=t.config,this.foldersSrvc.reset(r,o),this.filesSrvc.reset(r,o),e.next=6,this.rePath();case 6:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}()}},f=m,h=(r("d5af"),r("2877")),v=Object(h["a"])(f,o,i,!1,null,null,null);t["default"]=v.exports},"68ff":function(e,t,r){"use strict";var o=function(){var e=this,t=e.$createElement,r=e._self._c||t;return e.newFolderPrompt||e.newUploadPrompt||e.newFormPrompt||e.newDocPrompt?e.newFormPrompt?r("q-dialog",{ref:"newFormPrompt",attrs:{persistent:""},model:{value:e.newFormPrompt,callback:function(t){e.newFormPrompt=t},expression:"newFormPrompt"}},[r("juan-form",{attrs:{refs:e.$refs}})],1):e.newDocPrompt?r("q-dialog",{ref:"newDocPrompt",attrs:{persistent:""},model:{value:e.newDocPrompt,callback:function(t){e.newDocPrompt=t},expression:"newDocPrompt"}},[r("new-doc",{attrs:{refs:e.$refs}})],1):e.newFolderPrompt?r("q-dialog",{attrs:{persistent:""},model:{value:e.newFolderPrompt,callback:function(t){e.newFolderPrompt=t},expression:"newFolderPrompt"}},[r("q-card",{staticStyle:{"min-width":"400px"}},[r("q-card-section",[r("div",{staticClass:"text-h6"},[e._v("New folder")])]),r("q-card-section",[r("q-input",{attrs:{dense:"",autofocus:""},on:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.saveFolder(t)},focus:function(e){return e.target.select()}},model:{value:e.folderName,callback:function(t){e.folderName=t},expression:"folderName"}})],1),r("q-card-actions",{staticClass:"text-primary",attrs:{align:"right"}},[r("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{flat:"",label:"Cancel"}}),r("q-btn",{attrs:{color:"primary",label:"Create"},on:{click:e.saveFolder}})],1)],1)],1):r("q-dialog",{attrs:{persistent:""},on:{drop:function(e){e.preventDefault()}},model:{value:e.newUploadPrompt,callback:function(t){e.newUploadPrompt=t},expression:"newUploadPrompt"}},[r("q-card",{staticStyle:{"min-width":"400px"}},[r("q-card-section",{staticClass:"row"},[r("div",{staticClass:"text-h6 col"},[e._v("Upload")]),r("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{dense:"",round:"",icon:"close"},on:{click:function(t){return e.$refs.uploader.reset()}}})],1),r("q-card-section",{staticClass:"row"},[r("q-uploader",{ref:"qUpload",staticClass:"col no-shadow",attrs:{multiple:"",headers:[{name:"Authorization",value:e.$root.jwt}],url:e.$dbCon.io.io.uri+"/uploads","field-name":"file"},on:{uploaded:e.uploaded}})],1)],1)],1):r("q-menu",{ref:"newMenu",attrs:{"touch-position":"","context-menu":!e.leftClick,"auto-close":""},on:{drop:function(e){e.preventDefault()}}},[r("q-list",{staticStyle:{"min-width":"200px"},attrs:{dense:""}},[r("q-item",{directives:[{name:"ripple",rawName:"v-ripple"}],attrs:{clickable:""},on:{click:e.newFolder}},[r("q-item-section",{attrs:{avatar:""}},[r("q-icon",{attrs:{color:"blue-grey",name:"create_new_folder"}})],1),r("q-item-section",[e._v("New Folder")])],1),r("q-item",{directives:[{name:"ripple",rawName:"v-ripple"}],attrs:{clickable:""},on:{click:e.newFile}},[r("q-item-section",{attrs:{avatar:""}},[r("q-icon",{staticStyle:{left:"1px"},attrs:{size:"20px",color:"blue-grey",name:"fas fa-file-upload"}})],1),r("q-item-section",[e._v("Upload File")])],1),r("q-separator"),r("q-item",{directives:[{name:"ripple",rawName:"v-ripple"}],attrs:{clickable:""},on:{click:e.showNewDoc}},[r("q-item-section",{attrs:{avatar:""}},[r("q-icon",{staticStyle:{left:"1px"},attrs:{size:"20px",color:"blue",name:"fas fa-file-alt"}})],1),r("q-item-section",[e._v("New Doc (Phase 2)")])],1),r("q-item",{directives:[{name:"ripple",rawName:"v-ripple"}],attrs:{clickable:""},on:{click:e.showNewForm}},[r("q-item-section",{attrs:{avatar:""}},[r("q-icon",{staticStyle:{left:"5px"},attrs:{size:"20px",color:"purple",name:"fas fa-file-signature"}})],1),r("q-item-section",[e._v("New Form (Phase 2)")])],1)],1)],1)},i=[],s=r("967e"),n=r.n(s),a=(r("7f7f"),r("96cf"),r("fa84")),l=r.n(a),c=r("2bdc"),d=r("ed50"),u={components:{juanForm:c["a"],newDoc:d["a"]},props:["leftClick"],data:function(){return{jwt:window.localStorage.getItem("".concat(this.$dbCon.io.io.uri,"-jwt")),newFolderPrompt:!1,newUploadPrompt:!1,newFormPrompt:!1,newDocPrompt:!1,folderName:"Untitled folder"}},methods:{uploaded:function(){var e=l()(n.a.mark(function e(t){var r,o,i,s;return n.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return console.log("uploaded",t),console.log("pogiUpload",this.$refs.qUpload),r=Date.now(),o=t.files[0].name,i=JSON.parse(t.xhr.response),i.version="0",e.next=8,this.$dbCon.services["juan-files"].create({label:o,versions:[i],parentFolder:this.$root.currentFolder._id,isFolder:!1,timestamps:{created:r,modified:r},owner:this.$root.user._id,security:{public:!1,viewers:[],uploaders:[],modifiers:[],removers:[],folderCreators:[]},logs:[{action:"created",timestamp:r,user:this.$root.user}]});case 8:s=e.sent,this.$root.clickedItem=s,console.log("file uploaded timi",i),this.$dbCon.service("uploads").patch(i._id,{parentNode:s._id}),this.$q.notify({message:o+" was uploaded",position:"bottom-right",color:"positive"}),this.newUploadPrompt&&this.$refs.qUpload.files.length===this.$refs.qUpload.uploadedFiles.length&&(this.newUploadPrompt=!1,this.newFolderPrompt=!1);case 14:case"end":return e.stop()}},e,this)}));function t(t){return e.apply(this,arguments)}return t}(),newFolder:function(){this.newFolderPrompt=!0,this.folderName="Untitled folder",this.$refs.newMenu.toggle()},newFile:function(){this.newUploadPrompt=!0,this.newFolderPrompt=!1,this.newFormPrompt=!1,console.log("labas upload"),this.$refs.newMenu.toggle()},showNewForm:function(){this.newFormPrompt=!0,this.newDocPrompt=!1,this.newUploadPrompt=!1,this.newFolderPrompt=!1,this.$refs.newMenu.toggle()},showNewDoc:function(){this.newDocPrompt=!0,this.newFormPrompt=!1,this.newUploadPrompt=!1,this.newFolderPrompt=!1,this.$refs.newMenu.toggle()},saveFolder:function(){var e=l()(n.a.mark(function e(){var t;return n.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return t=Date.now(),e.next=3,this.$dbCon.services["juan-folders"].create({label:this.folderName,parentFolder:this.$root.currentFolder._id,isFolder:!0,timestamps:{created:t,modified:t},owner:this.$root.user._id,security:{public:!1,viewers:[],uploaders:[],modifiers:[],removers:[],folderCreators:[]},logs:[{action:"created",timestamp:t,user:this.$root.user}]});case 3:this.newFolderPrompt=!1;case 4:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}()}},p=u,m=r("2877"),f=Object(m["a"])(p,o,i,!1,null,null,null);t["a"]=f.exports},b520:function(e,t,r){},d5af:function(e,t,r){"use strict";var o=r("b520"),i=r.n(o);i.a}}]);